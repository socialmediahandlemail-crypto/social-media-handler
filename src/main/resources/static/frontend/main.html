<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <link rel="icon" type="image/webp" href="assets/Graphura-favicon.webp">
    <title>Graphura ‚Äì Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Configuration file -->
  <script src="config.js"></script>

  <style>
    .status-completed {
  background: linear-gradient(to right, #dcfce7, #bbf7d0);
  color: #166534;
  border: 1px solid #86efac;
  padding: 0.375rem 0.625rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 700;
  white-space: nowrap;
  display: inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
}

@media (max-width: 640px) {
  .status-completed {
    padding: 0.25rem 0.5rem;
    font-size: 0.625rem;
  }
}

/* Responsive status badge base styles */
.status-badge {
  padding: 0.375rem 0.625rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 700;
  display: inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

@media (max-width: 640px) {
  .status-badge {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
  }
}

    /* ===== SIDEBAR ===== */
    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 500;
      color: #475569;
      transition: all 0.25s ease;
    }

    .sidebar-link:hover {
      background: rgba(249,115,22,0.08);
      color: #f97316;
    }

    .sidebar-active {
      background: rgba(249,115,22,0.15);
      color: #f97316;
      box-shadow: inset 0 0 0 1px rgba(249,115,22,0.25);
      backdrop-filter: blur(12px);
    }

    .tab-btn {
      padding-bottom: 10px;
      font-weight: 500;
      color: #6b7280;
    }

    .tab-active {
      border-bottom: 2px solid #f97316;
      color: #f97316;
    }

    /* ===== VIEW TOGGLE BUTTONS ===== */
    .view-btn-group {
      position: relative;
      display: inline-flex;
      gap: 0;
      background: rgba(250, 251, 252, 0.95);
      border-radius: 12px;
      padding: 4px;
      border: 1.5px solid rgba(226, 232, 240, 0.6);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .view-btn {
      position: relative;
      z-index: 2;
      padding: 8px 22px;
      border: none;
      border-radius: 10px;
      background: transparent;
      color: #64748b;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      white-space: nowrap;
    }

    .view-btn.active {
      color: white;
      background: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
    }

    .view-btn:hover:not(.active) {
      color: #f97316;
      background: rgba(249, 115, 22, 0.08);
    }

    /* Sliding Background */
    .view-btn-group::before {
      content: '';
      position: absolute;
      z-index: 1;
      top: 4px;
      left: 4px;
      width: calc(50% - 2px);
      height: calc(100% - 8px);
      background: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
      border-radius: 10px;
      transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.28);
    }

    .view-btn-group.calendar-active::before {
      left: calc(50% + 2px);
    }

    /* ===== MOBILE SIDEBAR ===== */
    .mobile-menu-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: rgba(249, 115, 22, 0.12);
      border: 1px solid rgba(249, 115, 22, 0.25);
      cursor: pointer;
      transition: all 0.3s ease;
      flex-direction: column;
      padding: 0;
    }

    .mobile-menu-btn:hover {
      background: rgba(249, 115, 22, 0.2);
    }

    .mobile-menu-btn span {
      width: 20px;
      height: 2px;
      background: #f97316;
      display: block;
      margin: 3px 0;
      transition: all 0.3s ease;
    }

    .mobile-sidebar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 30;
    }

    .mobile-sidebar-overlay.open {
      background: rgba(0, 0, 0, 0.4);
      opacity: 1;
      pointer-events: auto;
    }

    .mobile-sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      width: 256px;
      background: white;
      border-r: 1px solid rgba(249, 115, 22, 0.2);
      transform: translateX(-100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 40;
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.15);
      overflow-y: auto;
    }

    .mobile-sidebar.open {
      transform: translateX(0);
    }

    @media (min-width: 1024px) {
      .mobile-menu-btn {
        display: none !important;
      }
      .mobile-sidebar-overlay {
        display: none !important;
      }
      .mobile-sidebar {
        display: none !important;
      }
    }

    /* Make mobile button more visible */
    .mobile-menu-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      border-radius: 8px;
      background: rgba(249, 115, 22, 0.12);
      border: 1px solid rgba(249, 115, 22, 0.25);
      cursor: pointer;
      transition: all 0.25s ease;
      flex-direction: column;
      padding: 0;
      flex-shrink: 0;
    }

    .mobile-menu-btn:hover {
      background: rgba(249, 115, 22, 0.2);
      border-color: rgba(249, 115, 22, 0.4);
    }

    .mobile-menu-btn span {
      width: 18px;
      height: 2px;
      background: #f97316;
      display: block;
      margin: 2.5px 0;
      transition: all 0.25s ease;
      border-radius: 1px;
    }

    /* ===== POST CARD ANIMATIONS ===== */
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shimmer {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    .post-card {
      animation: slideInUp 0.5s ease-out;
    }

    .post-card:nth-child(2) {
      animation-delay: 0.1s;
    }

    .post-card:nth-child(3) {
      animation-delay: 0.3s;
    }

    .post-card:nth-child(4) {
      animation-delay: 0.6s;
    }

    .post-card:nth-child(n+5) {
      animation-delay: 0.8s;
    }
  </style>
</head>

<body class="bg-white text-slate-800 min-h-screen">

<script>
  // Redirect admin users away from user pages to admin dashboard
  (function(){
    const authToken = localStorage.getItem('authToken');
    const role = localStorage.getItem('userRole');
    if (!authToken) {
      window.location.href = 'home.html';
      return;
    }
    if (role === 'ADMIN') {
      window.location.href = 'admin-dashboard.html';
      return;
    }
  })();
</script>

<!-- Notification root for toast cards -->
<div id="notification-root" aria-live="polite" class="fixed top-6 right-6 z-50"></div>

<!-- MOBILE SIDEBAR OVERLAY -->
<div id="mobileSidebarOverlay" class="mobile-sidebar-overlay" onclick="closeMobileSidebar()"></div>

<!-- MOBILE SIDEBAR -->
<aside id="mobileSidebar" class="mobile-sidebar">
  <!-- LOGO -->
  <div class="px-4 py-4 border-b flex items-center justify-between">
      <img src="assets/graphuralogo.png" class="h-12" alt="Graphura Logo" />
      <button class="text-gray-500 hover:text-gray-700 text-xl" onclick="closeMobileSidebar()">‚úï</button>
    </div>

  <!-- NAV -->
  <nav class="px-4 py-6 space-y-1 flex-1">
    <a href="main.html" class="sidebar-link sidebar-active" onclick="closeMobileSidebar()">
      Dashboard
    </a>
    <a href="connect.html" class="sidebar-link" onclick="closeMobileSidebar()">
      Channels
    </a>
    <a href="analysis.html" class="sidebar-link" onclick="closeMobileSidebar()">
      Analytics
    </a>
    <a href="help.html" class="sidebar-link" onclick="closeMobileSidebar()">
      Help & Guide
    </a>
    <a href="f&q.html" class="sidebar-link" onclick="closeMobileSidebar()">
      FAQs
    </a>
  </nav>

  <!-- USER PROFILE -->
  <div class="p-4 border-t relative">
    <button id="mobileSidebarProfileBtn"
      class="w-full flex items-center gap-3 p-3 rounded-full bg-white/80 border border-orange-200/40 shadow-sm hover:shadow-md hover:bg-orange-50/60 hover:border-orange-300/60 transition">
      <div class="w-9 h-9 rounded-full bg-gradient-to-br from-orange-200 to-pink-200 flex items-center justify-center font-bold">
        <img src="assets/user_icon.png" class="w-5 h-5" />
      </div>
      <div class="truncate text-left">
        <p id="mobileSidebarUserName" class="text-sm font-semibold text-slate-800">User</p>
        <p id="mobileSidebarUserEmail" class="text-xs text-slate-600 truncate"></p>
      </div>
    </button>

    <!-- DROPDOWN -->
    <div id="mobileSidebarProfileMenu"
      class="hidden absolute bottom-20 left-4 right-4 bg-white border rounded-xl shadow-xl overflow-hidden z-50">
      <button onclick="window.location.href='home.html'"
        class="w-full px-4 py-3 text-left text-slate-700 hover:bg-slate-50 font-medium border-b">
        Go to Home
      </button>
      <button onclick="logout()"
        class="w-full px-4 py-3 text-left text-red-600 hover:bg-red-50 font-medium">
        Logout
      </button>
    </div>
  </div>
</aside>

<!-- ================= APP LAYOUT ================= -->
<div class="flex min-h-screen">

  <!-- ================= SIDEBAR ================= -->
  <aside class="hidden lg:flex fixed left-0 top-0 h-screen w-64 bg-white border-r border-orange-200/30 flex flex-col justify-between">

    <!-- LOGO -->
    <div class="px-6 py-6 border-b flex items-center justify-center">
      <img src="assets/graphuralogo.png" class="h-16" />
    </div>

    <!-- NAV -->
    <nav class="px-4 py-6 space-y-1 flex-1">

      <a href="main.html" class="sidebar-link sidebar-active">
        Dashboard
      </a>
      <a href="connect.html" class="sidebar-link">
        Channels
      </a>
      <a href="analysis.html" class="sidebar-link">
        Analytics
      </a>
      <a href="help.html" class="sidebar-link">
        Help & Guide
      </a>
      <a href="f&q.html" class="sidebar-link">
        FAQs
      </a>

    </nav>

    <!-- USER PROFILE -->
    <div class="p-4 relative">

      <!-- Sidebar Profile (place LAST in sidebar) -->
<button id="sidebarProfileBtn"
  class="mt-auto w-full flex items-center gap-3
         px-4 py-3
         rounded-full
         bg-white/80 border border-orange-200/40
         hover:bg-orange-50/60 hover:border-orange-300/60
         shadow-sm hover:shadow-md
         transition">

  <!-- Avatar -->
  <div class="w-10 h-10 rounded-full
              bg-gradient-to-br from-orange-200 to-pink-200
              flex items-center justify-center
              shrink-0">
    <img src="assets/user_icon.png" class="w-5 h-5" alt="User" />
  </div>

  <!-- User Info -->
  <div class="min-w-0 text-left">
    <p id="sidebarUserName"
       class="text-sm font-semibold text-slate-800 leading-tight">
      User
    </p>

    <!-- Email: readable, not truncated harshly -->
    <p id="sidebarUserEmail"
       class="text-xs text-slate-600 leading-tight break-all">
      user@email.com
    </p>
  </div>

</button>


      <!-- DROPDOWN -->
      <div id="sidebarProfileMenu"
        class="hidden absolute bottom-20 left-4 right-4 bg-white border rounded-xl shadow-xl overflow-hidden z-50">

        <button onclick="window.location.href='home.html'"
          class="w-full px-4 py-3 text-left text-slate-700 hover:bg-slate-50 font-medium border-b">
          Go to Home
        </button>

        <button onclick="logout()"
          class="w-full px-4 py-3 text-left text-red-600 hover:bg-red-50 font-medium">
          Logout
        </button>

      </div>

    </div>

  </aside>
<!-- ================= MAIN CONTENT ================= -->
<main class="lg:ml-64 flex-1 px-4 lg:px-10 py-4 lg:py-8 bg-slate-50 relative overflow-y-auto overflow-x-hidden max-h-screen w-full">
    <div class="lg:hidden flex items-center justify-between px-4 py-4 bg-white border-b border-orange-200/30 fixed top-0 left-0 right-0 z-20">
      <img src="assets/graphuralogo.png" class="h-10" alt="Graphura Logo" />
      <button class="mobile-menu-btn" onclick="openMobileSidebar()" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  <!-- ===== DASHBOARD HEADER ===== -->
  <header class="mb-6 lg:mb-10 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 pt-16 lg:pt-0">

    <!-- TOP ROW: MOBILE BUTTON & TITLE -->
    <div class="flex items-start gap-3 sm:gap-4">

      <!-- TITLE AND DESCRIPTION -->
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-3">
          <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="3" y="3" width="7" height="7" rx="1.5" stroke-width="2"/>
            <rect x="14" y="3" width="7" height="7" rx="1.5" stroke-width="2"/>
            <rect x="3" y="14" width="7" height="7" rx="1.5" stroke-width="2"/>
            <rect x="14" y="14" width="7" height="7" rx="1.5" stroke-width="2"/>
          </svg>
          <h1 class="text-3xl sm:text-4xl lg:text-5xl font-black text-slate-900 tracking-tight">
            Dashboard
          </h1>
        </div>
        <p class="text-sm sm:text-base text-slate-600 mt-2 font-medium">
          Unified view of activity, performance, and insights.
        </p>
      </div>
    </div>

    <!-- BOTTOM ROW: BUTTONS (RIGHT SIDE ON LARGE SCREENS) -->
    <div class="flex items-center gap-3 sm:gap-4 flex-wrap">
      <!-- SCHEDULE POST BUTTON -->
      <button
        onclick="openModal()"
        class="flex items-center justify-center gap-1 sm:gap-2 bg-gradient-to-r from-orange-500 to-pink-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-bold transition-all active:scale-95 hover:-translate-y-0.5 shadow-lg shadow-orange-500/30">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4" />
        </svg>
        <span class="hidden sm:inline">Schedule Post</span>
        <span class="sm:hidden">Schedule</span>
      </button>

      <!-- VIEW TOGGLE BUTTONS -->
      <div class="view-btn-group">
  <button id="listBtn" class="view-btn active">
    <svg class="w-4 h-4 mr-2 inline-block align-middle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path d="M8 6h13M8 12h13M8 18h13" stroke-width="2" stroke-linecap="round"/>
      <circle cx="4" cy="6" r="1" fill="currentColor"/>
      <circle cx="4" cy="12" r="1" fill="currentColor"/>
      <circle cx="4" cy="18" r="1" fill="currentColor"/>
    </svg>
    List
  </button>

  <button id="calendarBtn" class="view-btn">
    <svg class="w-4 h-4 mr-2 inline-block align-middle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="16" rx="2" stroke-width="2"/>
      <path d="M16 3v4M8 3v4M3 9h18" stroke-width="2" stroke-linecap="round"/>
    </svg>
    Calendar
  </button>
</div>

  </header>

  <!-- ===== CONTENT CARD ===== -->
  <section class="relative z-10 bg-transparent
       rounded-2xl border-0
       shadow-none
       p-8 flex flex-col">

  <!-- ===== PREMIUM SENIOR-LEVEL TAB DESIGN ===== -->
  <div class="relative mb-8">
    <div id="postTabsContainer" class="flex gap-16 relative px-0.5">
      <!-- Animated Premium Underline with Shadow -->
      <div id="tabUnderline" class="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-orange-500 via-pink-500 to-pink-600 transition-all duration-600 ease-out rounded-full" style="width: 0; left: 0; box-shadow: 0 4px 20px rgba(249, 115, 22, 0.4);"></div>
      
      <!-- Scheduled Posts Tab -->
      <button id="upcomingTab" class="relative py-5 px-0.5 font-semibold text-base transition-all duration-300 group" onclick="switchPostTab('upcoming')">
        <span class="flex items-center gap-2.5 text-slate-600 group-hover:text-slate-800">
          <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="4" y="5" width="16" height="14" rx="2" stroke-width="1.5"/>
            <path d="M4 10h16M9 1v8M15 1v8" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>Scheduled Posts</span>
        </span>
      </button>
      
      <!-- Completed Posts Tab -->
      <button id="pastTab" class="relative py-5 px-0.5 font-semibold text-base transition-all duration-300 group" onclick="switchPostTab('past')">
        <span class="flex items-center gap-2.5 text-slate-400 group-hover:text-slate-600">
          <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path d="M9 3H5a2 2 0 00-2 2v12a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2h-4m-4 0a2 2 0 00-2 2v0a2 2 0 002 2h4a2 2 0 002-2v0a2 2 0 00-2-2m0 0V3a2 2 0 00-2-2h0a2 2 0 00-2 2v1m7 10l-3 3m0 0l-3-3m3 3v-6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Completed Posts</span>
        </span>
      </button>
    </div>
    
    <!-- Subtle Border -->
    <div class="h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent mt-0.5"></div>
  </div>

  <!-- ===== LIST VIEW (UPCOMING POSTS) ===== -->
  <section id="upcomingViewContent" class="flex-1 bg-gradient-to-br from-orange-50/20 via-white/40 to-pink-50/20 rounded-2xl p-6">
    <p class="text-gray-500 italic text-center py-16">
      Your scheduled posts list will appear here.
    </p>
  </section>

  <!-- ===== PAST UPDATES VIEW ===== -->
  <section id="pastViewContent" class="hidden flex-1 bg-gradient-to-br from-orange-50/20 via-white/40 to-pink-50/20 rounded-2xl p-6">
    <p class="text-gray-500 italic text-center py-16">
      Your past updates will appear here.
    </p>
  </section>

  <!-- ===== OLD LIST VIEW (KEPT FOR CALENDAR VIEW) ===== -->
  <section id="listViewContent" class="flex-1 hidden bg-gradient-to-br from-orange-50/40 to-pink-50/30 rounded-2xl p-6">
    <p class="text-gray-500 italic text-center py-16">
      Your scheduled posts list will appear here.
    </p>
  </section>

    <!-- ===== CALENDAR VIEW ===== -->
    <section id="calendarViewContent" class="hidden flex-1">

      <div class="flex items-center justify-between mb-2">

        <!-- MONTH CONTROLS (REQUIRED BY calender.js) -->
        <div class="flex items-center bg-white rounded-lg p-0.5 border border-orange-200/50">
          <button
            id="prevMonth"
            type="button"
            class="p-1 rounded-md hover:bg-orange-200/50 transition-colors text-slate-600 hover:text-orange-600 font-bold text-sm">
            ‚Üê
          </button>

          <h2
            id="calendarTitle"
            class="text-sm font-bold text-orange-600 px-3 min-w-[140px] text-center">
          </h2>

          <button
            id="nextMonth"
            type="button"
            class="p-1 rounded-md hover:bg-orange-200/50 transition-colors text-slate-600 hover:text-orange-600 font-bold text-sm">
            ‚Üí
          </button>
        </div>

      </div>

      <!-- WEEK HEADER -->
      <div class="grid grid-cols-7 text-center text-xs font-bold bg-white text-orange-700 uppercase mb-1 rounded-lg py-0.5 border border-orange-200/50">
        <span class="py-0.5">Sun</span><span class="py-0.5">Mon</span><span class="py-0.5">Tue</span>
        <span class="py-0.5">Wed</span><span class="py-0.5">Thu</span><span class="py-0.5">Fri</span><span class="py-0.5">Sat</span>
      </div>

      <!-- CALENDAR GRID (REQUIRED ID) -->
      <div
        id="calendarGrid"
        class="grid grid-cols-7 gap-0.5 bg-white p-0.5 border border-orange-200/40 rounded-lg overflow-hidden">
      </div>

    </section>

  </section>

</main>

<!-- POST DETAILS MODAL -->
<div id="postDetailsModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-[100] flex items-center justify-center p-4">
  <div class="bg-white/95 backdrop-blur-sm rounded-3xl w-full max-w-2xl overflow-hidden border border-slate-100 shadow-2xl">
    <!-- Modal Header -->
    <div class="p-5 bg-gradient-to-r from-white to-orange-50/40 border-b border-slate-100">
      <div class="flex items-start justify-between gap-4">
        <div class="flex items-center gap-4">
          <div id="detailPlatformIcon" class="w-14 h-14 rounded-xl bg-gradient-to-br from-orange-200 to-pink-200 flex items-center justify-center text-white text-lg shadow-md flex-shrink-0"></div>
          <div>
            <h3 id="detailModalTitle" class="text-2xl font-bold text-slate-900">Post Details</h3>
            <p id="detailModalPlatform" class="text-sm text-slate-500 mt-1">Platform</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <div id="detailStatusBadge" class="status-badge px-4 py-2 rounded-full font-bold bg-white/60 shadow-sm text-slate-800"></div>
          <button onclick="closePostDetailsModal()" class="w-9 h-9 rounded-lg hover:bg-slate-100 transition flex items-center justify-center text-slate-500 hover:text-slate-700">
            <span class="text-lg font-bold">√ó</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Content: responsive columns -->
    <div class="p-5 grid grid-cols-1 md:grid-cols-3 gap-4 max-h-[70vh] overflow-y-auto">
      <!-- Left: Media Preview -->
      <div class="md:col-span-1 flex flex-col gap-4">
        <div id="detailMediaContainer" class="hidden">
          <h4 class="text-sm font-bold text-slate-800 mb-2">Uploaded Media</h4>
          <div class="rounded-xl overflow-hidden h-64 bg-white border border-slate-100 shadow-md">
            <img id="detailMediaImage" src="" alt="media" class="w-full h-full object-cover hidden">
            <video id="detailMediaVideo" controls class="w-full h-full object-cover hidden"></video>
          </div>
        </div>
        <div class="bg-slate-50/60 rounded-lg p-3 border border-slate-100 shadow-sm">
          <p class="text-xs text-slate-500">Post ID</p>
          <p id="detailPostId" class="text-sm font-bold text-slate-800 truncate">--</p>
        </div>
        <div class="bg-slate-50/60 rounded-lg p-3 border border-slate-100 shadow-sm">
          <p class="text-xs text-slate-500">Status</p>
          <p id="detailStatus" class="text-sm font-bold text-slate-800">--</p>
        </div>
      </div>

      <!-- Right: Content & Details -->
      <div class="md:col-span-2 flex flex-col gap-4">
        <div>
          <h4 class="text-sm font-bold text-slate-800 mb-2">Description</h4>
          <div class="bg-white rounded-lg p-4 border border-slate-100 shadow-sm">
            <p id="detailContent" class="text-slate-700 leading-relaxed text-sm">Description will appear here</p>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <h4 class="text-xs font-semibold text-slate-600 uppercase mb-2">Scheduled</h4>
            <div class="bg-white rounded-lg p-3 border border-slate-100 shadow-sm">
              <p id="detailScheduledDate" class="text-sm font-bold text-slate-800">--</p>
              <p id="detailScheduledTime" class="text-xs text-slate-500">--</p>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="p-4 bg-white/80 border-t border-slate-100 flex gap-3">
      <button onclick="closePostDetailsModal()" class="flex-1 px-4 py-2 border border-slate-200 rounded-lg font-semibold text-slate-700 hover:bg-slate-50 transition">Close</button>
      <button onclick="deletePostFromModal()" class="flex-1 px-4 py-2 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-semibold hover:shadow-lg transition">Delete Post</button>
    </div>
  </div>
</div>

<div id="postModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-[100] flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200 border border-slate-200 max-h-[90vh] flex flex-col">
        <div class="p-4 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-orange-50/30">
            <div class="flex justify-between items-center">
              <div>
                <h3 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-pink-600">Schedule New Post</h3>
                <p class="text-xs text-slate-500 mt-0.5">Plan your social media content</p>
              </div>
              <button onclick="closeModal()" class="w-8 h-8 rounded-lg hover:bg-slate-200 transition flex items-center justify-center text-slate-400 hover:text-slate-600 flex-shrink-0">
                <span class="text-xl font-bold">&times;</span>
              </button>
            </div>
        </div>
        <form id="scheduleForm" class="p-4 space-y-3 overflow-y-auto flex-1">
            <div>
                <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-pink-600 mb-1">üì± Platform</label>
                <select id="platform" class="w-full border border-slate-300 rounded-lg p-2 bg-white focus:border-orange-400 focus:ring-2 focus:ring-orange-100 transition font-medium text-slate-700 text-sm">
                    <option value="FACEBOOK">Facebook</option>
                    <option value="LINKEDIN">LinkedIn</option>
                    <option value="TWITTER">Twitter</option>
                    <option value="YOUTUBE">YouTube</option>
                    <option value="PINTEREST">Pinterest</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-pink-600 mb-1">
  üí¨ Description
</label>

<textarea id="content" rows="5"
  class="w-full border border-slate-300 rounded-lg
         p-3 bg-white
         focus:border-orange-400 focus:ring-2 focus:ring-orange-100
         transition font-medium text-slate-700
         placeholder-slate-400 resize-none text-sm"
  placeholder="Type your description here..." required>
</textarea>

            </div>
            <div>
  <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-pink-600 mb-1 flex items-center gap-2">
    <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="14" rx="2" stroke-width="2"/>
      <circle cx="9" cy="11" r="2" stroke-width="2"/>
      <path d="M21 15l-5-5-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Media (Optional)
  </label>

  <input type="file" id="mediaFile" accept="image/*,video/*"
    class="w-full border border-slate-300 rounded-lg p-2 bg-white focus:border-orange-400 focus:ring-2 focus:ring-orange-100 transition font-medium text-slate-700 cursor-pointer file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:font-semibold file:bg-orange-100 file:text-orange-700 hover:file:bg-orange-200 text-sm">

  <p class="text-xs text-slate-500 mt-1">Images or Videos</p>
</div>

<div>
  <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-pink-600 mb-1 flex items-center gap-2">
    <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="16" rx="2" stroke-width="2"/>
      <path d="M16 3v4M8 3v4M3 9h18" stroke-width="2" stroke-linecap="round"/>
      <path d="M12 13v3l2 2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Schedule Time
  </label>

  <input type="datetime-local" id="scheduledTime"
    class="w-full border border-slate-300 rounded-lg p-2 bg-white focus:border-orange-400 focus:ring-2 focus:ring-orange-100 transition font-medium text-slate-700 text-sm"
    required>
</div>

            <div class="flex gap-2 pt-2">
                <button type="button" onclick="closeModal()" class="flex-1 px-3 py-2 border border-slate-300 rounded-lg font-semibold text-slate-600 hover:bg-slate-50 transition-colors text-sm">Cancel</button>
                <button type="submit" class="flex-1 px-3 py-2 bg-gradient-to-r from-orange-500 to-pink-500 text-white rounded-lg font-semibold hover:shadow-lg transition-all active:scale-95 text-sm">Schedule Now</button>
            </div>
        </form>
    </div>
</div>

<script src="component/sidebar.js"></script>
<script src="main.js"></script>
<script src="calender.js"></script>


<script>

  // Reload posts every 60 seconds to reflect backend changes (like auto-deletion)
setInterval(() => {
    console.log("üîÑ Auto-refreshing post list...");
    loadPosts(); 
}, 600000); // 600000 ms = 10 minute
function getComputedStatus(post) {
  const now = new Date();
  const scheduledDate = new Date(post.scheduledTime);

  if (post.status === "FAILED") return "FAILED";
  if (post.status === "SENT") return "SENT";

  if (scheduledDate <= now) return "COMPLETED";

  return "PENDING";
}

// ===== PLATFORM POSTING CONFIG =====
const PLATFORM_UPLOAD_CONFIG = {
  YOUTUBE: {
    endpoint: `${API_BASE_URL}/api/youtube/upload`,
    authScheme: "Bearer",
    enabled: true
  },
  FACEBOOK: {
    endpoint: `${API_BASE_URL}/api/facebook/upload`,
    authScheme: "OAuth",
    enabled: false
  },
  LINKEDIN: {
    endpoint: `${API_BASE_URL}/api/linkedin/upload`,
    authScheme: "OAuth",
    enabled: false
  },
  TWITTER: {
    endpoint: `${API_BASE_URL}/api/twitter/upload`,
    authScheme: "OAuth",
    enabled: false
  },
  PINTEREST: {
    endpoint: `${API_BASE_URL}/api/pinterest/upload`,
    authScheme: "OAuth",
    enabled: false
  },
  WHATSAPP: {
    endpoint: `${API_BASE_URL}/api/whatsapp/upload`,
    authScheme: "OAuth",
    enabled: false
  }
};

const POST_META_STORAGE_KEY = "scheduledPostMeta";
const POST_DISPATCH_STATE_KEY = "scheduledPostDispatchState";
const CONNECTION_CACHE_TTL_MS = 30000;
const USE_BACKEND_SCHEDULER = true;

let connectionCache = { fetchedAt: 0, data: null };
const scheduledPostTimers = {};

function prettyPlatformName(platform) {
  if (!platform) return "Platform";
  const upper = platform.toUpperCase();
  const map = {
    YOUTUBE: "YouTube",
    FACEBOOK: "Facebook",
    LINKEDIN: "LinkedIn",
    TWITTER: "Twitter / X",
    PINTEREST: "Pinterest",
    WHATSAPP: "WhatsApp"
  };
  return map[upper] || upper;
}

function getStoredJson(key, fallback) {
  try {
    const raw = localStorage.getItem(key);
    if (!raw) return fallback;
    return JSON.parse(raw);
  } catch (e) {
    return fallback;
  }
}

function setStoredJson(key, value) {
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch (e) {
    // ignore storage errors
  }
}

function extractUrlFromResponseText(text) {
  if (!text) return null;
  try {
    const data = JSON.parse(text);
    const candidate = data.url || data.videoUrl || data.platformPostUrl || data.link;
    if (candidate) return candidate;
  } catch (e) {
    // ignore non-JSON responses
  }
  const match = text.match(/https?:\/\/[^\s"'<>]+/);
  if (!match) return null;
  return match[0].replace(/[).,]+$/, "");
}

function getPostMetaMap() {
  return getStoredJson(POST_META_STORAGE_KEY, {});
}

function savePostMeta(postId, meta) {
  if (!postId) return;
  const map = getPostMetaMap();
  map[postId] = { ...(map[postId] || {}), ...(meta || {}) };
  setStoredJson(POST_META_STORAGE_KEY, map);
}

function removePostMeta(postId) {
  if (!postId) return;
  const map = getPostMetaMap();
  if (map[postId]) {
    delete map[postId];
    setStoredJson(POST_META_STORAGE_KEY, map);
  }
}

function getDispatchState() {
  return getStoredJson(POST_DISPATCH_STATE_KEY, {});
}

function markDispatched(postId, status, details) {
  if (!postId) return;
  const state = getDispatchState();
  state[postId] = {
    status,
    at: new Date().toISOString(),
    ...(details || {})
  };
  setStoredJson(POST_DISPATCH_STATE_KEY, state);
}

function clearDispatchState(postId) {
  if (!postId) return;
  const state = getDispatchState();
  if (state[postId]) {
    delete state[postId];
    setStoredJson(POST_DISPATCH_STATE_KEY, state);
  }
}

function isDispatched(postId) {
  const state = getDispatchState();
  return !!state[postId];
}

async function fetchConnectionStatus(force = false) {
  const now = Date.now();
  if (!force && connectionCache.data && now - connectionCache.fetchedAt < CONNECTION_CACHE_TTL_MS) {
    return connectionCache.data;
  }

  const token = localStorage.getItem("authToken");
  if (!token) return null;

  try {
    const response = await fetch(API_ENDPOINTS.SOCIAL.STATUS, {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      }
    });

    if (!response.ok) {
      return null;
    }

    const data = await response.json();
    connectionCache = { fetchedAt: now, data };
    return data;
  } catch (error) {
    console.error("Failed to load connection status:", error);
    return null;
  }
}

async function ensurePlatformConnected(platform, showToast = true) {
  const data = await fetchConnectionStatus();
  const connections = data && data.connections ? data.connections : null;
  const upper = (platform || "").toUpperCase();
  const isConnected = connections ? !!connections[upper] : false;

  if (!isConnected && showToast) {
    showNotification("error", `‚ùå You are not connected to ${prettyPlatformName(upper)}`);
  }
  return isConnected;
}

function deriveYouTubeTitle(content) {
  if (!content) return "Scheduled Post";
  const trimmed = content.trim().replace(/\s+/g, " ");
  if (!trimmed) return "Scheduled Post";
  return trimmed.length > 80 ? trimmed.substring(0, 80) : trimmed;
}

function buildUploadPayload(platform, post) {
  const upper = (platform || "").toUpperCase();
  if (upper === "YOUTUBE") {
    return {
      title: post.title || deriveYouTubeTitle(post.content),
      description: post.description || post.content || "",
      privacy: post.privacy || "public",
      mediaUrl: post.mediaUrl,
      mediaType: post.mediaType
    };
  }

  // Generic fallback (adjust per platform when backend APIs are available)
  return {
    platform: upper,
    content: post.content || "",
    mediaUrl: post.mediaUrl || null,
    mediaType: post.mediaType || null
  };
}

async function triggerPlatformPost(post) {
  if (!post || !post.id || isDispatched(post.id)) return;

  const platform = (post.platform || "").toUpperCase();
  const config = PLATFORM_UPLOAD_CONFIG[platform];

  if (!config) {
    markDispatched(post.id, "UNSUPPORTED", { platform });
    return;
  }

  if (!config.enabled) {
    showNotification("error", `‚ùå Posting API not available for ${prettyPlatformName(platform)} yet.`);
    markDispatched(post.id, "UNAVAILABLE", { platform });
    return;
  }

  const isConnected = await ensurePlatformConnected(platform, true);
  if (!isConnected) {
    markDispatched(post.id, "NOT_CONNECTED", { platform });
    return;
  }

  const token = localStorage.getItem("authToken");
  if (!token) {
    showNotification("error", "‚ùå Please login again to publish scheduled posts.");
    markDispatched(post.id, "NO_AUTH", { platform });
    return;
  }

  const payload = buildUploadPayload(platform, post);

  if (platform === "YOUTUBE") {
    if (!payload.mediaUrl) {
      showNotification("error", "‚ùå YouTube posting requires a video upload.");
      markDispatched(post.id, "NO_MEDIA", { platform });
      return;
    }
    if (payload.mediaType && payload.mediaType.toUpperCase() === "IMAGE") {
      showNotification("error", "‚ùå YouTube does not allow image-only uploads.");
      markDispatched(post.id, "INVALID_MEDIA", { platform });
      return;
    }
  }

  try {
    const response = await fetch(config.endpoint, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `${config.authScheme} ${token}`
      },
      body: JSON.stringify(payload)
    });

    if (response.ok) {
      let platformPostUrl = null;
      try {
        const responseText = await response.text();
        platformPostUrl = extractUrlFromResponseText(responseText);
      } catch (e) {
        // ignore response parsing
      }

      if (platform === "YOUTUBE" && platformPostUrl) {
        savePostMeta(post.id, { platformPostUrl });
        if (Array.isArray(allPosts)) {
          allPosts = allPosts.map(item =>
            item && item.id === post.id ? { ...item, platformPostUrl } : item
          );
        }
        refreshCurrentPostView();
      }
      showNotification("success", `‚úÖ ${prettyPlatformName(platform)} post published.`);
      markDispatched(post.id, "SUCCESS", { platform });
    } else {
      let errorMessage = response.statusText;
      try {
        const errorData = await response.json();
        errorMessage = errorData.message || errorMessage;
      } catch (e) {
        // ignore JSON parse
      }
      showNotification("error", `‚ùå ${prettyPlatformName(platform)} posting failed: ${errorMessage}`);
      markDispatched(post.id, "FAILED", { platform });
    }
  } catch (error) {
    console.error("Posting failed:", error);
    showNotification("error", `‚ùå ${prettyPlatformName(platform)} posting failed. Please try again.`);
    markDispatched(post.id, "FAILED", { platform });
  }
}

function schedulePostDispatches(posts) {
  if (USE_BACKEND_SCHEDULER) {
    return;
  }
  if (!Array.isArray(posts)) return;
  posts.forEach((post) => {
    if (!post || !post.id) return;
    const status = (post.status || "").toUpperCase();
    if (status === "FAILED" || status === "SENT" || status === "POSTED") return;
    if (!post.scheduledTime) return;

    const scheduledDate = new Date(post.scheduledTime);
    if (Number.isNaN(scheduledDate.getTime())) return;

    if (isDispatched(post.id)) return;

    const delay = scheduledDate.getTime() - Date.now();
    if (delay <= 0) {
      triggerPlatformPost(post);
      return;
    }

    if (scheduledPostTimers[post.id]) return;
    scheduledPostTimers[post.id] = setTimeout(() => {
      triggerPlatformPost(post);
    }, delay);
  });
}


  // Sidebar profile dropdown
  const sidebarProfileBtn = document.getElementById("sidebarProfileBtn");
  const sidebarProfileMenu = document.getElementById("sidebarProfileMenu");

  sidebarProfileBtn.addEventListener("click", e => {
    e.stopPropagation();
    sidebarProfileMenu.classList.toggle("hidden");
  });

  document.addEventListener("click", () => {
    sidebarProfileMenu.classList.add("hidden");
  });

  async function logout() {
    let ok;
    if (typeof showConfirm === 'function') {
      ok = await showConfirm('Are you sure you want to logout?');
    } else {
      ok = confirm('Are you sure you want to logout?');
    }
    if (ok) {
      localStorage.clear();
      window.location.href = "home.html";
    }
  }

  window.onload = () => {
    const token = localStorage.getItem("authToken");
    if (!token) window.location.href = "home.html";

    const userEmail = localStorage.getItem("userEmail") || "";
    const userName = localStorage.getItem("userName") || "User";

    // Update desktop sidebar
    document.getElementById("sidebarUserEmail").textContent = userEmail;
    document.getElementById("sidebarUserName").textContent = userName;

    // Update mobile sidebar
    document.getElementById("mobileSidebarUserEmail").textContent = userEmail;
    document.getElementById("mobileSidebarUserName").textContent = userName;
  };
  
// Modal control functions
function openModal() {
    document.getElementById('postModal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('postModal').classList.add('hidden');
    document.getElementById('scheduleForm').reset();
    window.uploadedMediaUrl = null;
    window.uploadedMediaType = null;
}

// Attach openModal to your "New Post" button
document.querySelectorAll('button').forEach(btn => {
    if(btn.innerText.includes('New Post') || btn.innerText.includes('Schedule Post')) {
        btn.onclick = openModal;
    }
});
// Form submission handler
document.getElementById('scheduleForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const platform = document.getElementById('platform').value;
    const mediaFile = document.getElementById('mediaFile').files[0];

    const isConnected = await ensurePlatformConnected(platform, true);
    if (!isConnected) {
        closeModal();
        return;
    }

    if (platform === "YOUTUBE" && !mediaFile) {
        showNotification('error', '‚ùå YouTube post requires a video upload.');
        return;
    }
    
    // ===== BACKEND MEDIA UPLOAD CONNECTION POINT =====
    // TODO: Implement media upload to backend
    // 1. Create FormData object with file
    // 2. Send POST request to: https://social-media-handler-backend.onrender.com/api/media/upload
    // 3. Get media ID/URL from response
    // 4. Include mediaId/mediaUrl in postData below
    
    let mediaId = null;
    if (mediaFile) {
        try {
            const formData = new FormData();
            formData.append('file', mediaFile);
            formData.append('platform', platform);
            
            // ===== UPLOAD MEDIA TO BACKEND =====
            const mediaResponse = await fetch(API_ENDPOINTS.MEDIA.UPLOAD, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('authToken')
                    // Note: Do NOT set Content-Type, browser will set it with correct boundary
                },
                body: formData
            });
            
            if (mediaResponse.ok) {
                const mediaData = await mediaResponse.json();
                mediaId = mediaData.mediaId || mediaData.id || mediaData.url; // Get media ID
                // Also store mediaUrl if backend returns it
                window.uploadedMediaUrl = mediaData.url || mediaData.mediaUrl || mediaData.path || null;
                window.uploadedMediaType = mediaData.mediaType || null;
                console.log("Media uploaded successfully:", mediaId);
                console.log("Media URL:", window.uploadedMediaUrl);
            } else {
                console.warn("Media upload failed, proceeding without media");
            }
        } catch (error) {
            console.error("Error uploading media:", error);
            console.warn("Proceeding with post without media");
        }
    }

    if (platform === "YOUTUBE") {
        if (!window.uploadedMediaUrl) {
            showNotification('error', '‚ùå Media upload failed. Please try again.');
            return;
        }
        if (window.uploadedMediaType && window.uploadedMediaType.toUpperCase() === "IMAGE") {
            showNotification('error', '‚ùå YouTube requires a video file, not an image.');
            return;
        }
    }
    
    const content = document.getElementById('content').value;
    const scheduledTime = document.getElementById('scheduledTime').value;

    const postData = {
        platform: platform,
        content: content,
        scheduledTime: scheduledTime,
        status: "PENDING",
        mediaId: mediaId, // Include uploaded media ID if available
        mediaUrl: window.uploadedMediaUrl || null, // Include media URL if available
        mediaType: window.uploadedMediaType || null
    };

    try {
        const response = await fetch(API_ENDPOINTS.POSTS.SCHEDULE, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + localStorage.getItem('authToken')
            },
            body: JSON.stringify(postData)
        });

        if (response.ok) {
          const savedPost = await response.json();
          if (savedPost && savedPost.id) {
            savePostMeta(savedPost.id, {
              platform: platform,
              content: content,
              scheduledTime: scheduledTime,
              mediaUrl: window.uploadedMediaUrl || null,
              mediaType: window.uploadedMediaType || null,
              title: deriveYouTubeTitle(content),
              description: content,
              privacy: "public"
            });
          }
          showNotification('success', '‚úÖ Post scheduled successfully!');
          closeModal();
          // Clear the temporary media URL
          window.uploadedMediaUrl = null;
          window.uploadedMediaType = null;
          loadPosts(); // UI refresh karne ke liye
        } else {
          const errorData = await response.json();
          showNotification('error', '‚ùå Error: ' + (errorData.message || 'Failed to schedule post'));
        }
    } catch (error) {
      console.error("Error sending data:", error);
      showNotification('error', 'Server se connection fail ho gaya.');
    }
});

// Store posts data globally
let allPosts = [];
let currentPostView = 'upcoming';

// Switch between Upcoming and Past posts
function switchPostTab(tabName) {
    // Prevent toggle bug: don't do anything if same tab is clicked
    if (currentPostView === tabName) {
        return;
    }
    
    currentPostView = tabName;
    
    const upcomingBtn = document.getElementById('upcomingTab');
    const pastBtn = document.getElementById('pastTab');
    const upcomingContent = document.getElementById('upcomingViewContent');
    const pastContent = document.getElementById('pastViewContent');
    const tabUnderline = document.getElementById('tabUnderline');
    
    if (tabName === 'upcoming') {
        // Active: Upcoming
        upcomingBtn.classList.remove('text-slate-400');
        upcomingBtn.classList.add('text-slate-900');
        
        // Inactive: Past
        pastBtn.classList.remove('text-slate-900');
        pastBtn.classList.add('text-slate-400');
        
        // Position underline under Scheduled Posts
        const tabWidth = upcomingBtn.offsetWidth;
        tabUnderline.style.left = upcomingBtn.offsetLeft + 'px';
        tabUnderline.style.width = tabWidth + 'px';
        
        // Show upcoming, hide past
        upcomingContent.classList.remove('hidden');
        pastContent.classList.add('hidden');
        renderUpcomingPosts();
    } else {
        // Active: Past
        pastBtn.classList.remove('text-slate-400');
        pastBtn.classList.add('text-slate-900');
        
        // Inactive: Upcoming
        upcomingBtn.classList.remove('text-slate-900');
        upcomingBtn.classList.add('text-slate-400');
        
        // Position underline under Completed Posts
        const tabWidth = pastBtn.offsetWidth;
        tabUnderline.style.left = pastBtn.offsetLeft + 'px';
        tabUnderline.style.width = tabWidth + 'px';
        
        // Show past, hide upcoming
        pastContent.classList.remove('hidden');
        upcomingContent.classList.add('hidden');
        renderPastPosts();
    }
}

// Initialize tabs on page load
window.addEventListener('DOMContentLoaded', function() {
    const upcomingBtn = document.getElementById('upcomingTab');
    const tabUnderline = document.getElementById('tabUnderline');
    
    // Set initial underline position
    if (upcomingBtn) {
        const tabWidth = upcomingBtn.offsetWidth;
        tabUnderline.style.left = upcomingBtn.offsetLeft + 'px';
        tabUnderline.style.width = tabWidth + 'px';
    }
    
    // Handle window resize to adjust underline
    window.addEventListener('resize', function() {
        const activeBtn = currentPostView === 'upcoming' 
            ? document.getElementById('upcomingTab') 
            : document.getElementById('pastTab');
        
        if (activeBtn && tabUnderline) {
            const tabWidth = activeBtn.offsetWidth;
            tabUnderline.style.left = activeBtn.offsetLeft + 'px';
            tabUnderline.style.width = tabWidth + 'px';
        }
    });
});

async function loadPosts() {
    const contentArea = document.getElementById('contentArea');
    try {
        const response = await fetch(API_ENDPOINTS.POSTS.ALL, {
            headers: { 'Authorization': 'Bearer ' + localStorage.getItem('authToken') }
        });
        allPosts = await response.json();

        // Hydrate posts with locally stored media/meta (needed for YouTube uploads)
        const metaMap = getPostMetaMap();
        if (Array.isArray(allPosts)) {
            allPosts = allPosts.map(post => {
                const meta = post && post.id ? metaMap[post.id] : null;
                return meta ? { ...post, ...meta } : post;
            });
        }

        // Schedule publishing for pending posts
        schedulePostDispatches(allPosts);

        if (allPosts.length === 0) {
            document.getElementById('upcomingViewContent').innerHTML = `
              <div class="flex flex-col items-center justify-center py-24 px-6 rounded-2xl
bg-gradient-to-br from-[#ffffff] to-[#f7f3ef]
border border-[#f0eae4] shadow-sm"

             >
  
  <div class="w-28 h-28 rounded-full bg-gradient-to-br from-orange-200 to-pink-200 flex items-center justify-center mb-8 shadow-xl border-4 border-orange-300/50 animate-bounce">
    <svg class="w-14 h-14 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="6" y="4" width="12" height="16" rx="2" stroke-width="2"/>
      <path d="M9 4h6v2a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1V4Z" stroke-width="2"/>
      <path d="M9 12h6M9 16h4" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </div>

  <h3 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-pink-600 mb-3">
    No Posts Yet
  </h3>

  <p class="text-slate-600 text-center max-w-sm font-medium mb-2">
    Start by creating your first post to see it displayed here
  </p>
  <p class="text-slate-500 text-center max-w-sm text-sm mb-8">
    Manage all your social media posts in one place
  </p>

  <button onclick="openModal()" class="px-8 py-3.5 bg-gradient-to-r from-orange-500 to-pink-500 text-white rounded-xl font-bold text-base hover:shadow-lg hover:from-orange-600 hover:to-pink-600 transition-all active:scale-95 border border-orange-400/60 shadow-md flex items-center gap-2">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
    </svg>
    Create First Post
  </button>

</div>

            `;
            if(contentArea) contentArea.classList.remove('hidden');
            return;
        }
        if(contentArea) contentArea.classList.add('hidden');
        
        // Render upcoming posts by default
        renderUpcomingPosts();

    } catch (error) {
        console.error("Error loading posts:", error);
        document.getElementById('upcomingViewContent').innerHTML = `<p class="text-red-500 italic text-center">Error loading posts.</p>`;
    }
}

// Render upcoming posts
function renderUpcomingPosts() {
    const now = new Date();
    const upcomingPosts = allPosts.filter(post => new Date(post.scheduledTime) > now);
    
    const listView = document.getElementById('upcomingViewContent');
    
    if (upcomingPosts.length === 0) {
        listView.innerHTML = `
          <div class="flex flex-col items-center justify-center py-24 px-6 rounded-2xl
bg-gradient-to-br from-[#ffffff] to-[#f7f3ef]
border border-[#f0eae4] shadow-sm"

             >
  
  <div class="w-28 h-28 rounded-full bg-gradient-to-br from-orange-200 to-pink-200 flex items-center justify-center mb-8 shadow-xl border-4 border-orange-300/50 animate-bounce">
    <svg class="w-14 h-14 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="6" y="4" width="12" height="16" rx="2" stroke-width="2"/>
      <path d="M9 4h6v2a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1V4Z" stroke-width="2"/>
      <path d="M9 12h6M9 16h4" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </div>

  <h3 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-pink-600 mb-3">
    No Posts Yet
  </h3>

  <p class="text-slate-600 text-center max-w-sm font-medium mb-2">
    Start by creating your first post to see it displayed here
  </p>
  <p class="text-slate-500 text-center max-w-sm text-sm mb-8">
    Manage all your social media posts in one place
  </p>

  <button onclick="openModal()" class="px-8 py-3.5 bg-gradient-to-r from-orange-500 to-pink-500 text-white rounded-xl font-bold text-base hover:shadow-lg hover:from-orange-600 hover:to-pink-600 transition-all active:scale-95 border border-orange-400/60 shadow-md flex items-center gap-2">
    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
    </svg>
    Create First Post
  </button>

</div>
        `;
        return;
    }
    
    renderPostCards(upcomingPosts, listView);
}

// Render past posts
function renderPastPosts() {
    const now = new Date();
    const pastPosts = allPosts.filter(post => new Date(post.scheduledTime) <= now);
    
    const pastView = document.getElementById('pastViewContent');
    
    if (pastPosts.length === 0) {
        pastView.innerHTML = `
<div class="flex flex-col items-center justify-center py-24 px-6 rounded-2xl
bg-gradient-to-br from-[#ffffff] to-[#f7f3ef]
shadow-sm"
>
  
  <div class="w-28 h-28 rounded-full bg-gradient-to-br from-orange-200 to-pink-200 flex items-center justify-center mb-8 shadow-xl border-4 border-orange-300/50">
    <svg class="w-14 h-14 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path d="M3 3v5h5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="12" cy="12" r="8" stroke-width="2"/>
      <path d="M12 8v5l3 2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>

  <h3 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-orange-600 to-pink-600 mb-3">
    No Past Updates Yet
  </h3>

  <p class="text-slate-600 text-center max-w-sm font-medium mb-2">
    Your completed scheduled posts will appear here
  </p>
  <p class="text-slate-500 text-center max-w-sm text-sm">
    Once their scheduled time passes, they'll show up in this tab
  </p>

</div>


        `;
        return;
    }
    
    renderPostCards(pastPosts, pastView);
}

function refreshCurrentPostView() {
    if (currentPostView === 'past') {
        renderPastPosts();
    } else {
        renderUpcomingPosts();
    }
}

// Common function to render post cards
function renderPostCards(posts, container) {
    let cardsHtml = `
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
`;
    
    posts.forEach(post => {
        const now = new Date();
        const scheduledDate = new Date(post.scheduledTime);
        const isPast = scheduledDate <= now;
        
        

        const platformIcon =
            post.platform === "FACEBOOK" ? "assets/facebook.png" :
            post.platform === "LINKEDIN" ? "assets/linkedin.png" :
            post.platform === "TWITTER" ? "assets/twitter.png" :
            post.platform === "YOUTUBE" ? "assets/youtube.png" :
            post.platform === "PINTEREST" ? "assets/pintrest.png" : "assets/graphuralogo.png";

          const accentColor =
            post.platform === "FACEBOOK" ? "blue" :
            post.platform === "LINKEDIN" ? "blue" :
            post.platform === "TWITTER" ? "slate" :
            post.platform === "YOUTUBE" ? "red" :
            post.platform === "PINTEREST" ? "rose" : "orange";

        const computedStatus = getComputedStatus(post);
        const platformPostUrl =
          post.platform === "YOUTUBE"
            ? (post.platformPostUrl || post.youtubeUrl || post.videoUrl || post.postUrl || post.url)
            : (post.platformPostUrl || post.postUrl || post.url);
        const showYoutubeUrl =
          post.platform === "YOUTUBE" &&
          platformPostUrl &&
          (computedStatus === "COMPLETED" || computedStatus === "SENT");

         const statusStyle =
         computedStatus === "COMPLETED"
        ? "status-completed"
        : computedStatus === "FAILED"
        ? "bg-red-100 text-red-700"
        : computedStatus === "SENT"
        ? "bg-orange-100 text-orange-700"
        : "bg-slate-100 text-slate-700";


        cardsHtml += `
    <div class="post-card group relative rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer border border-slate-100 flex flex-col h-full bg-white hover:border-orange-200/50 bg-gradient-to-br from-white via-slate-50/30 to-white">
      
      <!-- Gradient Top Accent Bar -->
      <div class="h-1 w-full bg-gradient-to-r from-orange-400 via-pink-400 to-orange-400 group-hover:via-pink-500 transition-all duration-300"></div>
      
      <div class="p-5 relative z-10 flex flex-col flex-1">
        
        <!-- Header: Platform Icon & Status Badge -->
        <div class="flex items-start justify-between mb-4 gap-3">
          <!-- Platform Icon Container -->
          <div class="relative flex-shrink-0">
            <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-orange-100 to-pink-100 flex items-center justify-center group-hover:shadow-lg group-hover:scale-110 transition-all duration-300 border border-orange-200/50 shadow-md overflow-hidden p-2">
              <img src="${platformIcon}" alt="${post.platform}" class="w-full h-full object-contain drop-shadow-sm">
            </div>
            <!-- Platform Badge -->
            <span class="absolute -bottom-2 -right-2 px-2 py-1 bg-gradient-to-r from-orange-500 to-pink-500 text-white text-xs font-bold rounded-full shadow-md border border-orange-400">
              ${post.platform.charAt(0)}
            </span>
          </div>
          
          <!-- Status Badge (Right Aligned) -->
          <div class="flex flex-col items-end gap-2 flex-shrink-0">
            <span class="px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap shadow-md ${statusStyle}">
              ${computedStatus}
            </span>
            ${post.mediaUrl ? '<div class="px-2.5 py-1 rounded-lg text-xs font-semibold bg-gradient-to-r from-purple-100 to-indigo-100 text-purple-700 border border-purple-200/60 shadow-sm flex items-center gap-1"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M4 6h16v12c0 1.1-.9 2-2 2H6c-1.1 0-2-.9-2-2V6zm0-2v2h16V4H4z"/></svg> Media</div>' : ''}
          </div>
        </div>

        <!-- Platform Name -->
        <h3 class="text-lg font-bold text-slate-800 mb-3 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-orange-600 group-hover:to-pink-600 transition-all duration-300">
          ${post.platform}
        </h3>

        <!-- Media Preview with Enhanced Styling -->
        ${post.mediaUrl ? `
          <div class="mb-4 rounded-lg overflow-hidden h-28 bg-gradient-to-br from-slate-200 to-slate-300 flex-shrink-0 border border-slate-300/50 shadow-md group-hover:shadow-lg transition-all duration-300 relative">
            ${post.mediaUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i) ? 
              `<img src="${post.mediaUrl}" alt="media" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">` :
              `<video src="${post.mediaUrl}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"></video>`
            }
            <!-- Overlay on hover -->
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all duration-300"></div>
          </div>
        ` : ''}

        <!-- Content Preview with Better Typography -->
        <div class="mb-4 p-3 rounded-lg bg-gradient-to-br from-orange-50/40 to-pink-50/40 border border-orange-200/30 flex-grow">
          <p class="text-slate-700 text-sm leading-relaxed line-clamp-3 font-medium">
            "${post.content}"
          </p>
        </div>

        <!-- Details Section with Icons -->
        <div class="space-y-3 pt-4 border-t border-orange-200/40">

          <!-- Scheduled Date & Time -->
          <div class="flex items-center gap-3 text-sm group/detail hover:bg-orange-50/50 p-2 rounded-lg transition-all duration-200">
            <svg class="w-5 h-5 text-orange-600 flex-shrink-0 group-hover/detail:text-pink-600 transition-colors" fill="currentColor" viewBox="0 0 24 24">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5-10h-4v4h4v-4z"/>
            </svg>
            <div class="flex-grow">
              <p class="text-slate-600 text-xs uppercase tracking-wide font-semibold">
                Scheduled
              </p>
              <p class="text-slate-800 font-bold text-sm">
                ${scheduledDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} at ${scheduledDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}
              </p>
            </div>
          </div>

          ${showYoutubeUrl ? `
          <div class="flex items-center gap-3 text-sm group/detail hover:bg-red-50/50 p-2 rounded-lg transition-all duration-200">
            <svg class="w-5 h-5 text-red-600 flex-shrink-0 group-hover/detail:text-red-700 transition-colors" fill="currentColor" viewBox="0 0 24 24">
              <path d="M10 8l6 4-6 4V8z"></path>
              <path d="M21 6.5a2.5 2.5 0 0 0-1.8-1.8C17.4 4.2 12 4.2 12 4.2s-5.4 0-7.2.5A2.5 2.5 0 0 0 3 6.5 26.2 26.2 0 0 0 2.5 12a26.2 26.2 0 0 0 .5 5.5 2.5 2.5 0 0 0 1.8 1.8c1.8.5 7.2.5 7.2.5s5.4 0 7.2-.5a2.5 2.5 0 0 0 1.8-1.8c.3-1.8.5-5.5.5-5.5s-.2-3.7-.5-5.5z"></path>
            </svg>
            <div class="flex-grow min-w-0">
              <p class="text-slate-600 text-xs uppercase tracking-wide font-semibold">
                YouTube URL
              </p>
              <a href="${platformPostUrl}" target="_blank" rel="noopener" class="text-red-600 font-bold text-sm truncate hover:underline block">
                ${platformPostUrl}
              </a>
            </div>
          </div>
          ` : ''}

        </div>

        <!-- Action Button - Enhanced -->
        <button onclick="openPostDetailsModal(${JSON.stringify(post).replace(/"/g, '&quot;')})" class="w-full mt-5 py-2.5 px-4 bg-gradient-to-r from-orange-500 to-pink-500 text-white rounded-xl font-bold text-sm hover:shadow-lg hover:from-orange-600 hover:to-pink-600 transition-all active:scale-95 flex-shrink-0 border border-orange-400/50 shadow-md flex items-center justify-center gap-2 group/btn">
          <svg class="w-4 h-4 group-hover/btn:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
          View Details
        </button>
      </div>
    </div>
  `;
    });

    cardsHtml += `</div>`;
    container.innerHTML = cardsHtml;
}

// Page load par posts load karein
window.addEventListener('DOMContentLoaded', loadPosts);

// ===== POST DETAILS MODAL FUNCTIONS =====
let currentPost = null;

function openPostDetailsModal(post) {
    currentPost = post;

    // ===== COMPUTE STATUS BASED ON TIME =====
    const now = new Date();
    const scheduledDate = new Date(post.scheduledTime);

    let computedStatus = post.status;

    // üî• TIME-BASED STATUS OVERRIDE
    if (post.status === "PENDING" && scheduledDate <= now) {
        computedStatus = "COMPLETED";
    }

    // ===== PLATFORM ICONS =====
    const platformIcons = {
        "FACEBOOK": "assets/facebook.png",
        "LINKEDIN": "assets/linkedin.png",
        "TWITTER": "assets/twitter.png",
        "YOUTUBE": "assets/youtube.png",
        "PINTEREST": "assets/pintrest.png",
        "DEFAULT": "assets/graphuralogo.png"
    };

    // ===== STATUS STYLES =====
    const statusStyles = {
      "PENDING": "bg-slate-100 text-slate-700",
      "COMPLETED": "status-completed",
      "SENT": "bg-orange-100 text-orange-700",
      "FAILED": "bg-red-100 text-red-700"
    };

    // ===== STATUS BADGE (FIXED) =====
    const badge = document.getElementById('detailStatusBadge');
    badge.textContent = computedStatus;
    badge.className = `status-badge px-4 py-2 sm:px-3 sm:py-1.5 rounded-lg font-bold max-w-[200px] sm:max-w-[250px] ${statusStyles[computedStatus] || statusStyles["PENDING"]}`;

    // ===== MODAL HEADER =====
    document.getElementById('detailModalTitle').textContent = post.platform;
    document.getElementById('detailModalPlatform').textContent = `Scheduled on ${post.platform}`;

    // ===== PLATFORM ICON =====
    const iconElement = document.getElementById('detailPlatformIcon');
    iconElement.innerHTML = `
        <img src="${platformIcons[post.platform] || platformIcons.DEFAULT}"
             alt="${post.platform}"
             class="w-full h-full object-contain p-2">
    `;

    // ===== MEDIA HANDLING =====
    const detailMediaContainer = document.getElementById('detailMediaContainer');
    const detailMediaImage = document.getElementById('detailMediaImage');
    const detailMediaVideo = document.getElementById('detailMediaVideo');

    const mediaUrl =
        post.mediaUrl ||
        post.media ||
        post.mediaLink ||
        post.mediaPath ||
        null;

    if (mediaUrl) {
        detailMediaContainer.classList.remove('hidden');

        if (mediaUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
            detailMediaImage.src = mediaUrl;
            detailMediaImage.classList.remove('hidden');
            detailMediaVideo.classList.add('hidden');
        } else if (mediaUrl.match(/\.(mp4|webm|ogg|mov|avi)$/i)) {
            detailMediaVideo.src = mediaUrl;
            detailMediaVideo.classList.remove('hidden');
            detailMediaImage.classList.add('hidden');
        }
    } else {
        detailMediaContainer.classList.add('hidden');
        detailMediaImage.classList.add('hidden');
        detailMediaVideo.classList.add('hidden');
    }

    // ===== CONTENT =====
    document.getElementById('detailContent').textContent = post.content;

    document.getElementById('detailScheduledDate').textContent =
        scheduledDate.toLocaleDateString();

    document.getElementById('detailScheduledTime').textContent =
        scheduledDate.toLocaleTimeString();

    document.getElementById('detailPostId').textContent =
        post.id || 'N/A';

    // üî• FIXED STATUS TEXT (IMPORTANT)
    document.getElementById('detailStatus').textContent = computedStatus;

    // ===== SHOW MODAL =====
    const modal = document.getElementById('postDetailsModal');
    modal.classList.remove('hidden');

    // Close modal when clicking outside
    modal.onclick = (e) => {
        if (e.target.id === 'postDetailsModal') {
            closePostDetailsModal();
        }
    };
}


function closePostDetailsModal() {
    document.getElementById('postDetailsModal').classList.add('hidden');
    currentPost = null;
}

// Delete post from card
async function deletePost(postId) {
    const ok = await showConfirm('Are you sure you want to delete this scheduled post?');
    if (!ok) return;

    try {
        const response = await fetch(API_ENDPOINTS.POSTS.GET_BY_ID(postId), {
            method: 'DELETE',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('authToken'),
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
          showNotification('success', '‚úÖ Post deleted successfully!');
          removePostMeta(postId);
          clearDispatchState(postId);
          loadPosts(); // Refresh the list
        } else {
          const errorData = await response.json();
          showNotification('error', '‚ùå Error: ' + (errorData.message || 'Failed to delete post'));
        }
    } catch (error) {
      console.error('Error deleting post:', error);
      showNotification('error', '‚ùå Error deleting post. Please try again.');
    }
}

// Delete post from modal
async function deletePostFromModal() {
    if (!currentPost) return;
    
    const ok = await showConfirm('Are you sure you want to delete this scheduled post?');
    if (!ok) return;

    try {
        const response = await fetch(API_ENDPOINTS.POSTS.UPDATE(currentPost.id), {
            method: 'DELETE',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('authToken'),
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
          showNotification('success', '‚úÖ Post deleted successfully!');
          if (currentPost && currentPost.id) {
            removePostMeta(currentPost.id);
            clearDispatchState(currentPost.id);
          }
          closePostDetailsModal();
          loadPosts(); // Refresh the list
        } else {
          const errorData = await response.json();
          showNotification('error', '‚ùå Error: ' + (errorData.message || 'Failed to delete post'));
        }
    } catch (error) {
      console.error('Error deleting post:', error);
      showNotification('error', '‚ùå Error deleting post. Please try again.');
    }
}

// Close modal on Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closePostDetailsModal();
    }
});

// Mobile Sidebar Functions
function openMobileSidebar() {
  const mobileSidebar = document.getElementById('mobileSidebar');
  const overlay = document.getElementById('mobileSidebarOverlay');
  mobileSidebar.classList.add('open');
  overlay.classList.add('open');
}

function closeMobileSidebar() {
  const mobileSidebar = document.getElementById('mobileSidebar');
  const overlay = document.getElementById('mobileSidebarOverlay');
  mobileSidebar.classList.remove('open');
  overlay.classList.remove('open');
}

// Mobile Sidebar Profile Menu
document.addEventListener('DOMContentLoaded', function() {
  const mobileSidebarProfileBtn = document.getElementById('mobileSidebarProfileBtn');
  const mobileSidebarProfileMenu = document.getElementById('mobileSidebarProfileMenu');

  if (mobileSidebarProfileBtn && mobileSidebarProfileMenu) {
    mobileSidebarProfileBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      mobileSidebarProfileMenu.classList.toggle('hidden');
    });

    document.addEventListener('click', (e) => {
      if (!mobileSidebarProfileBtn.contains(e.target) && !mobileSidebarProfileMenu.contains(e.target)) {
        mobileSidebarProfileMenu.classList.add('hidden');
      }
    });
  }
});

// Notification utility (replaces alert())
function _injectNotificationStyles() {
  if (document.getElementById('notif-styles')) return;
  const css = `
  #notification-root { display:flex; flex-direction:column; gap:10px; }
  .notif-card{min-width:280px;max-width:360px;padding:14px 16px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.08);display:flex;align-items:flex-start;gap:12px;border:1px solid rgba(2,6,23,0.04);font-family:Inter,system-ui,Arial}
  .notif-card strong{display:block;font-weight:700;color:#0f172a}
  .notif-success{background:linear-gradient(180deg,#ecfdf5,#f0fdf4);border-color:rgba(16,185,129,0.08);}
  .notif-error{background:linear-gradient(180deg,#fff1f0,#fff7f5);border-color:rgba(239,68,68,0.06);}
  .notif-icon{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;flex-shrink:0}
  .notif-success .notif-icon{background:linear-gradient(90deg,#10b981,#059669);color:#fff}
  .notif-error .notif-icon{background:linear-gradient(90deg,#fb7185,#f97316);color:#fff}
  .notif-body{flex:1;color:#0f172a;font-size:14px}
  .notif-close{margin-left:8px;background:transparent;border:none;color:rgba(15,23,42,0.6);cursor:pointer;padding:6px;border-radius:8px;transition:background .15s ease,color .15s ease,transform .15s ease}
  .notif-close:hover{background:rgba(15,23,42,0.08);color:rgba(15,23,42,0.9);transform:translateY(-1px)}
  .notif-enter{animation:notifIn .28s cubic-bezier(.2,.9,.2,1)}
  .notif-leave{animation:notifOut .28s ease forwards}
  @keyframes notifIn{from{transform:translateY(-8px);opacity:0}to{transform:translateY(0);opacity:1}}
  @keyframes notifOut{to{transform:translateY(-12px);opacity:0;height:0;margin:0;padding:0}}
  `;
  const s = document.createElement('style'); s.id = 'notif-styles'; s.innerHTML = css; document.head.appendChild(s);
}

function showNotification(type, message, timeout = 4500) {
  _injectNotificationStyles();
  const root = document.getElementById('notification-root');
  if (!root) return alert(message);

  const card = document.createElement('div');
  card.className = 'notif-card notif-' + (type === 'error' ? 'error' : 'success') + ' notif-enter';

  const icon = document.createElement('div'); icon.className = 'notif-icon';
  icon.innerHTML = type === 'error' ? '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 9v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10.29 3.86L1.82 18.35A2 2 0 0 0 3.6 21h16.8a2 2 0 0 0 1.78-2.65L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="none" fill="currentColor"/></svg>' : '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>';

  const body = document.createElement('div'); body.className = 'notif-body';
  body.innerHTML = `<div>${message}</div>`;

  const closeBtn = document.createElement('button'); closeBtn.className = 'notif-close'; closeBtn.innerHTML = '&#10005;';
  closeBtn.onclick = () => { card.classList.add('notif-leave'); setTimeout(() => card.remove(), 300); };

  card.appendChild(icon); card.appendChild(body); card.appendChild(closeBtn);
  root.prepend(card);

  const t = setTimeout(() => { if (card.parentElement) { card.classList.add('notif-leave'); setTimeout(() => card.remove(), 300); } }, timeout);

  return { element: card, close: () => { clearTimeout(t); if (card.parentElement) { card.remove(); } } };
}

</script>

</body>
</html>

<!-- Confirmation card helper (appended) -->
<div id="confirm-root" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:10000;pointer-events:auto">
  <div id="confirm-backdrop" style="position:absolute;inset:0;background:rgba(2,6,23,0.45);"></div>
  <div id="confirm-card" style="position:relative;min-width:320px;max-width:520px;background:white;border-radius:14px;padding:20px 18px;box-shadow:0 20px 50px rgba(2,6,23,0.18);display:flex;flex-direction:column;gap:12px;z-index:10001;font-family:Inter,system-ui,Arial">
    <div style="display:flex;gap:12px;align-items:flex-start">
      <div style="width:44px;height:44px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(90deg,#fb7185,#f97316);color:#fff">?</div>
      <div style="flex:1">
        <div id="confirm-title" style="font-weight:700;color:#0f172a;font-size:16px">Confirm action</div>
        <div id="confirm-message" style="color:#475569;font-size:14px;margin-top:6px">Are you sure?</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:6px">
      <button id="confirm-cancel" style="background:#fff;border:1px solid rgba(2,6,23,0.06);padding:8px 12px;border-radius:10px;color:#0f172a;">Cancel</button>
      <button id="confirm-accept" style="background:linear-gradient(90deg,#10b981,#059669);color:#fff;padding:8px 12px;border-radius:10px;border:1px solid rgba(6,95,70,0.08);">Confirm</button>
    </div>
  </div>
</div>

<script>
  // showConfirm(message) -> Promise<boolean>
  function showConfirm(message, options = {}) {
    return new Promise((resolve) => {
      const root = document.getElementById('confirm-root');
      const msgEl = document.getElementById('confirm-message');
      const acceptBtn = document.getElementById('confirm-accept');
      const cancelBtn = document.getElementById('confirm-cancel');
      const backdrop = document.getElementById('confirm-backdrop');

      if (!root || !msgEl || !acceptBtn || !cancelBtn) {
        // fallback to window.confirm
        resolve(window.confirm(message));
        return;
      }

      msgEl.textContent = message;
      root.style.display = 'flex';

      const cleanup = () => {
        acceptBtn.onclick = null;
        cancelBtn.onclick = null;
        backdrop.onclick = null;
        root.style.display = 'none';
      };

      acceptBtn.onclick = () => {
        cleanup();
        resolve(true);
      };

      cancelBtn.onclick = () => {
        cleanup();
        resolve(false);
      };

      backdrop.onclick = () => {
        cleanup();
        resolve(false);
      };
    });
  }
</script>
