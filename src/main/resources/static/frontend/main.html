<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Graphura ‚Äì Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Configuration file -->
  <script src="config.js"></script>

  <style>
    .status-completed {
  background: linear-gradient(to right, #dcfce7, #bbf7d0);
  color: #166534;
  border: 1px solid #86efac;
  padding: 0.375rem 0.625rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 700;
  white-space: nowrap;
  display: inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
}

@media (max-width: 640px) {
  .status-completed {
    padding: 0.25rem 0.5rem;
    font-size: 0.625rem;
  }
}

/* Responsive status badge base styles */
.status-badge {
  padding: 0.375rem 0.625rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 700;
  display: inline-block;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

@media (max-width: 640px) {
  .status-badge {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
  }
}

    /* ===== SIDEBAR ===== */
    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      font-weight: 500;
      color: #475569;
      transition: all 0.25s ease;
    }

    .sidebar-link:hover {
      background: rgba(6,182,212,0.08);
      color: #0891b2;
    }

    .sidebar-active {
      background: rgba(6,182,212,0.15);
      color: #0891b2;
      box-shadow: inset 0 0 0 1px rgba(6,182,212,0.25);
      backdrop-filter: blur(12px);
    }

    .tab-btn {
      padding-bottom: 10px;
      font-weight: 500;
      color: #6b7280;
    }

    .tab-active {
      border-bottom: 2px solid #2563eb;
      color: #2563eb;
    }

    /* ===== VIEW TOGGLE BUTTONS ===== */
    .view-btn-group {
      position: relative;
      display: inline-flex;
      gap: 0;
      background: #f1f5f9;
      border-radius: 12px;
      padding: 4px;
      border: 1.5px solid #e2e8f0;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .view-btn {
      position: relative;
      z-index: 2;
      padding: 8px 22px;
      border: none;
      border-radius: 10px;
      background: transparent;
      color: #64748b;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      flex: 1;
      white-space: nowrap;
    }

    .view-btn.active {
      color: white;
    }

    .view-btn:hover:not(.active) {
      color: #475569;
    }

    /* Sliding Background */
    .view-btn-group::before {
      content: '';
      position: absolute;
      z-index: 1;
      top: 4px;
      left: 4px;
      width: calc(50% - 2px);
      height: calc(100% - 8px);
      background: #06b6d4;
      border-radius: 10px;
      transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(6, 182, 212, 0.28);

    }

    .view-btn-group.calendar-active::before {
      left: calc(50% + 2px);
    }

    /* ===== MOBILE SIDEBAR ===== */
    .mobile-menu-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: rgba(6, 182, 212, 0.1);
      border: 1px solid rgba(6, 182, 212, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
      flex-direction: column;
      padding: 0;
    }

    .mobile-menu-btn:hover {
      background: rgba(6, 182, 212, 0.2);
    }

    .mobile-menu-btn span {
      width: 20px;
      height: 2px;
      background: #0891b2;
      display: block;
      margin: 3px 0;
      transition: all 0.3s ease;
    }

    .mobile-sidebar-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      z-index: 30;
    }

    .mobile-sidebar-overlay.open {
      background: rgba(0, 0, 0, 0.4);
      opacity: 1;
      pointer-events: auto;
    }

    .mobile-sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      width: 256px;
      background: white;
      border-r: 1px solid rgba(6, 182, 212, 0.3);
      transform: translateX(-100%);
      transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 40;
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.15);
      overflow-y: auto;
    }

    .mobile-sidebar.open {
      transform: translateX(0);
    }

    @media (min-width: 1024px) {
      .mobile-menu-btn {
        display: none !important;
      }
      .mobile-sidebar-overlay {
        display: none !important;
      }
      .mobile-sidebar {
        display: none !important;
      }
    }

    /* Make mobile button more visible */
    .mobile-menu-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      border-radius: 8px;
      background: rgba(6, 182, 212, 0.12);
      border: 1px solid rgba(6, 182, 212, 0.25);
      cursor: pointer;
      transition: all 0.25s ease;
      flex-direction: column;
      padding: 0;
      flex-shrink: 0;
    }

    .mobile-menu-btn:hover {
      background: rgba(6, 182, 212, 0.2);
      border-color: rgba(6, 182, 212, 0.4);
    }

    .mobile-menu-btn span {
      width: 18px;
      height: 2px;
      background: #0891b2;
      display: block;
      margin: 2.5px 0;
      transition: all 0.25s ease;
      border-radius: 1px;
    }
  </style>
</head>

<body class="bg-white text-slate-800 min-h-screen">

<!-- MOBILE SIDEBAR OVERLAY -->
<div id="mobileSidebarOverlay" class="mobile-sidebar-overlay" onclick="closeMobileSidebar()"></div>

<!-- MOBILE SIDEBAR -->
<aside id="mobileSidebar" class="mobile-sidebar">
  <!-- LOGO -->
  <div class="px-4 py-4 border-b flex items-center justify-between">
      <img src="assets/graphuralogo.png" class="h-12" alt="Graphura Logo" />
      <button class="text-gray-500 hover:text-gray-700 text-xl" onclick="closeMobileSidebar()">‚úï</button>
    </div>

  <!-- NAV -->
  <nav class="px-4 py-6 space-y-1 flex-1">
    <a href="main.html" class="sidebar-link sidebar-active" onclick="closeMobileSidebar()">
      Dashboard
    </a>
    <a href="connect.html" class="sidebar-link" onclick="closeMobileSidebar()">
      Channels
    </a>
    <a href="analysis.html" class="sidebar-link" onclick="closeMobileSidebar()">
      Analytics
    </a>
    <a href="help.html" class="sidebar-link" onclick="closeMobileSidebar()">
      Help & Guide
    </a>
    <a href="f&q.html" class="sidebar-link" onclick="closeMobileSidebar()">
      FAQs
    </a>
  </nav>

  <!-- USER PROFILE -->
  <div class="p-4 border-t relative">
    <button id="mobileSidebarProfileBtn"
      class="w-full flex items-center gap-3 p-3 rounded-xl bg-white shadow-sm hover:shadow transition">
      <div class="w-9 h-9 rounded-full bg-cyan-100 text-cyan-600 flex items-center justify-center font-bold">
        <img src="assets/user_icon.png" class="w-5 h-5" />
      </div>
      <div class="truncate text-left">
        <p id="mobileSidebarUserName" class="text-sm font-semibold">User</p>
        <p id="mobileSidebarUserEmail" class="text-xs text-gray-500 truncate"></p>
      </div>
    </button>

    <!-- DROPDOWN -->
    <div id="mobileSidebarProfileMenu"
      class="hidden absolute bottom-20 left-4 right-4 bg-white border rounded-xl shadow-xl overflow-hidden z-50">
      <button onclick="logout()"
        class="w-full px-4 py-3 text-left text-red-600 hover:bg-red-50 font-medium">
        Logout
      </button>
    </div>
  </div>
</aside>

<!-- ================= APP LAYOUT ================= -->
<div class="flex min-h-screen">

  <!-- ================= SIDEBAR ================= -->
  <aside class="hidden lg:flex fixed left-0 top-0 h-screen w-64 bg-white border-r border-cyan-200/30 flex flex-col justify-between">

    <!-- LOGO -->
    <div class="px-6 py-6 border-b flex items-center justify-center">
      <img src="assets/graphuralogo.png" class="h-16" />
    </div>

    <!-- NAV -->
    <nav class="px-4 py-6 space-y-1 flex-1">

      <a href="main.html" class="sidebar-link sidebar-active">
        Dashboard
      </a>
      <a href="connect.html" class="sidebar-link">
        Channels
      </a>
      <a href="analysis.html" class="sidebar-link">
        Analytics
      </a>
      <a href="help.html" class="sidebar-link">
        Help & Guide
      </a>
      <a href="f&q.html" class="sidebar-link">
        FAQs
      </a>

    </nav>

    <!-- USER PROFILE -->
    <div class="p-4 relative">

      <!-- Sidebar Profile (place LAST in sidebar) -->
<button id="sidebarProfileBtn"
  class="mt-auto w-full flex items-center gap-3
         px-4 py-3
         border-t border-slate-200
         hover:bg-slate-50
         transition">

  <!-- Avatar -->
  <div class="w-10 h-10 rounded-full
              bg-cyan-100
              flex items-center justify-center
              shrink-0">
    <img src="assets/user_icon.png" class="w-5 h-5" alt="User" />
  </div>

  <!-- User Info -->
  <div class="min-w-0 text-left">
    <p id="sidebarUserName"
       class="text-sm font-semibold text-slate-800 leading-tight">
      User
    </p>

    <!-- Email: readable, not truncated harshly -->
    <p id="sidebarUserEmail"
       class="text-xs text-slate-500 leading-tight break-all">
      user@email.com
    </p>
  </div>

</button>


      <!-- DROPDOWN -->
      <div id="sidebarProfileMenu"
        class="hidden absolute bottom-20 left-4 right-4 bg-white border rounded-xl shadow-xl overflow-hidden z-50">

        <button onclick="logout()"
          class="w-full px-4 py-3 text-left text-red-600 hover:bg-red-50 font-medium">
          Logout
        </button>

      </div>

    </div>

  </aside>
<!-- ================= MAIN CONTENT ================= -->
<main class="lg:ml-64 flex-1 px-4 lg:px-10 py-4 lg:py-8 bg-slate-50 relative overflow-y-auto overflow-x-hidden max-h-screen w-full">
    <div class="lg:hidden flex items-center justify-between px-4 py-4 bg-white border-b border-cyan-200/30 fixed top-0 left-0 right-0 z-20">
      <img src="assets/graphuralogo.png" class="h-10" alt="Graphura Logo" />
      <button class="mobile-menu-btn" onclick="openMobileSidebar()" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  <!-- ===== DASHBOARD HEADER ===== -->
  <header class="mb-6 lg:mb-10 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 pt-16 lg:pt-0">

    <!-- TOP ROW: MOBILE BUTTON & TITLE -->
    <div class="flex items-start gap-3 sm:gap-4">

      <!-- TITLE AND DESCRIPTION -->
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-3">
          <svg class="w-8 h-8 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="3" y="3" width="7" height="7" rx="1.5" stroke-width="2"/>
            <rect x="14" y="3" width="7" height="7" rx="1.5" stroke-width="2"/>
            <rect x="3" y="14" width="7" height="7" rx="1.5" stroke-width="2"/>
            <rect x="14" y="14" width="7" height="7" rx="1.5" stroke-width="2"/>
          </svg>
          <h1 class="text-3xl sm:text-4xl lg:text-5xl font-black text-slate-900 tracking-tight">
            Dashboard
          </h1>
        </div>
        <p class="text-sm sm:text-base text-slate-600 mt-2 font-medium">
          Unified view of activity, performance, and insights.
        </p>
      </div>
    </div>

    <!-- BOTTOM ROW: BUTTONS (RIGHT SIDE ON LARGE SCREENS) -->
    <div class="flex items-center gap-3 sm:gap-4 flex-wrap">
      <!-- SCHEDULE POST BUTTON -->
      <button
        onclick="openModal()"
        class="flex items-center justify-center gap-1 sm:gap-2 bg-cyan-500 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-lg sm:rounded-xl text-xs sm:text-sm font-bold transition-all active:scale-95 hover:-translate-y-0.5">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 sm:h-4 sm:w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4" />
        </svg>
        <span class="hidden sm:inline">Schedule Post</span>
        <span class="sm:hidden">Schedule</span>
      </button>

      <!-- VIEW TOGGLE BUTTONS -->
      <div class="view-btn-group">
  <button id="listBtn" class="view-btn active">
    <svg class="w-4 h-4 mr-2 inline-block align-middle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path d="M8 6h13M8 12h13M8 18h13" stroke-width="2" stroke-linecap="round"/>
      <circle cx="4" cy="6" r="1" fill="currentColor"/>
      <circle cx="4" cy="12" r="1" fill="currentColor"/>
      <circle cx="4" cy="18" r="1" fill="currentColor"/>
    </svg>
    List
  </button>

  <button id="calendarBtn" class="view-btn">
    <svg class="w-4 h-4 mr-2 inline-block align-middle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="16" rx="2" stroke-width="2"/>
      <path d="M16 3v4M8 3v4M3 9h18" stroke-width="2" stroke-linecap="round"/>
    </svg>
    Calendar
  </button>
</div>

  </header>

  <!-- ===== CONTENT CARD ===== -->
  <section class="relative z-10 bg-white/70 backdrop-blur-md
       rounded-2xl border
       shadow-sm
       p-8 flex flex-col">

  <!-- ===== PREMIUM SENIOR-LEVEL TAB DESIGN ===== -->
  <div class="relative mb-8">
    <div id="postTabsContainer" class="flex gap-16 relative px-0.5">
      <!-- Animated Premium Underline with Shadow -->
      <div id="tabUnderline" class="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-cyan-500 via-blue-500 to-blue-600 transition-all duration-600 ease-out rounded-full" style="width: 0; left: 0; box-shadow: 0 4px 20px rgba(6, 182, 212, 0.4);"></div>
      
      <!-- Scheduled Posts Tab -->
      <button id="upcomingTab" class="relative py-5 px-0.5 font-semibold text-base transition-all duration-300 group" onclick="switchPostTab('upcoming')">
        <span class="flex items-center gap-2.5 text-slate-600 group-hover:text-slate-800">
          <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="4" y="5" width="16" height="14" rx="2" stroke-width="1.5"/>
            <path d="M4 10h16M9 1v8M15 1v8" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>Scheduled Posts</span>
        </span>
      </button>
      
      <!-- Completed Posts Tab -->
      <button id="pastTab" class="relative py-5 px-0.5 font-semibold text-base transition-all duration-300 group" onclick="switchPostTab('past')">
        <span class="flex items-center gap-2.5 text-slate-400 group-hover:text-slate-600">
          <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path d="M9 3H5a2 2 0 00-2 2v12a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2h-4m-4 0a2 2 0 00-2 2v0a2 2 0 002 2h4a2 2 0 002-2v0a2 2 0 00-2-2m0 0V3a2 2 0 00-2-2h0a2 2 0 00-2 2v1m7 10l-3 3m0 0l-3-3m3 3v-6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Completed Posts</span>
        </span>
      </button>
    </div>
    
    <!-- Subtle Border -->
    <div class="h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent mt-0.5"></div>
  </div>

  <!-- ===== LIST VIEW (UPCOMING POSTS) ===== -->
  <section id="upcomingViewContent" class="flex-1">
    <p class="text-gray-500 italic text-center py-16">
      Your scheduled posts list will appear here.
    </p>
  </section>

  <!-- ===== PAST UPDATES VIEW ===== -->
  <section id="pastViewContent" class="hidden flex-1">
    <p class="text-gray-500 italic text-center py-16">
      Your past updates will appear here.
    </p>
  </section>

  <!-- ===== OLD LIST VIEW (KEPT FOR CALENDAR VIEW) ===== -->
  <section id="listViewContent" class="flex-1 hidden">
    <p class="text-gray-500 italic text-center py-16">
      Your scheduled posts list will appear here.
    </p>
  </section>

    <!-- ===== CALENDAR VIEW ===== -->
    <section id="calendarViewContent" class="hidden flex-1">

      <div class="flex items-center justify-between mb-2">

        <!-- MONTH CONTROLS (REQUIRED BY calender.js) -->
        <div class="flex items-center bg-white rounded-lg p-0.5 border border-cyan-200/50">
          <button
            id="prevMonth"
            type="button"
            class="p-1 rounded-md hover:bg-cyan-200/50 transition-colors text-slate-600 hover:text-cyan-600 font-bold text-sm">
            ‚Üê
          </button>

          <h2
            id="calendarTitle"
            class="text-sm font-bold text-cyan-600 px-3 min-w-[140px] text-center">
          </h2>

          <button
            id="nextMonth"
            type="button"
            class="p-1 rounded-md hover:bg-cyan-200/50 transition-colors text-slate-600 hover:text-cyan-600 font-bold text-sm">
            ‚Üí
          </button>
        </div>

      </div>

      <!-- WEEK HEADER -->
      <div class="grid grid-cols-7 text-center text-xs font-bold bg-white text-cyan-700 uppercase mb-1 rounded-lg py-0.5 border border-cyan-200/50">
        <span class="py-0.5">Sun</span><span class="py-0.5">Mon</span><span class="py-0.5">Tue</span>
        <span class="py-0.5">Wed</span><span class="py-0.5">Thu</span><span class="py-0.5">Fri</span><span class="py-0.5">Sat</span>
      </div>

      <!-- CALENDAR GRID (REQUIRED ID) -->
      <div
        id="calendarGrid"
        class="grid grid-cols-7 gap-0.5 bg-white p-0.5 border border-cyan-200/40 rounded-lg overflow-hidden">
      </div>

    </section>

  </section>

</main>

<!-- POST DETAILS MODAL -->
<div id="postDetailsModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-[100] flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl w-full max-w-xl overflow-hidden border border-slate-200 shadow-xl">
        <!-- Modal Header -->
        <div class="p-6 border-b border-slate-200 bg-white">
            <div class="flex justify-between items-start gap-4">
              <div class="flex-1">
                <h3 class="text-2xl font-bold text-cyan-600" id="detailModalTitle">Post Details</h3>
                <p class="text-sm text-slate-500 mt-2" id="detailModalPlatform">Platform</p>
              </div>
              <button onclick="closePostDetailsModal()" class="w-8 h-8 rounded-lg hover:bg-slate-200 transition flex items-center justify-center text-slate-400 hover:text-slate-600 flex-shrink-0">
                <span class="text-xl font-bold">&times;</span>
              </button>
            </div>
        </div>
        
        <!-- Modal Content -->
        <div class="p-6 space-y-5 max-h-[60vh] overflow-y-auto">
            <!-- Status Badge -->
            <div class="flex items-center justify-between">
              <div id="detailStatusBadge" class="status-badge px-4 py-2 sm:px-3 sm:py-1.5 rounded-lg font-bold max-w-[200px] sm:max-w-[250px]">
                Status
              </div>
              <div id="detailPlatformIcon" class="w-12 h-12 rounded-lg flex items-center justify-center text-2xl flex-shrink-0"></div>
            </div>

            <!-- Media Preview in Modal -->
            <div id="detailMediaContainer" class="hidden">
              <h4 class="text-sm font-bold text-cyan-600 mb-3">üñºÔ∏è Uploaded Media Preview</h4>
              <div class="rounded-xl overflow-hidden h-64 bg-slate-100 border-2 border-slate-300 shadow-lg">
                <img id="detailMediaImage" src="" alt="media" class="w-full h-full object-cover hidden">
                <video id="detailMediaVideo" controls class="w-full h-full object-cover hidden"></video>
              </div>
            </div>

            <!-- Full Message Content -->
            <div>
              <h4 class="text-sm font-bold text-cyan-600 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <rect x="6" y="4" width="12" height="16" rx="2" stroke-width="2"/>
           <path d="M9 9h6M9 13h6" stroke-width="2" stroke-linecap="round"/>
           </svg>
           Message Content
          </h4>

             <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
           <p class="text-slate-700 leading-relaxed text-sm" id="detailContent">
              Message content will appear here
             </p>
             </div>
             </div>


            <!-- Schedule Information -->
            <div class="grid grid-cols-2 gap-4">
  <div>
    <h4 class="text-sm font-bold text-cyan-600 mb-2 flex items-center gap-2">
      <svg class="w-4 h-4 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <rect x="3" y="5" width="18" height="16" rx="2" stroke-width="2"/>
        <path d="M16 3v4M8 3v4M3 9h18" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Scheduled Date
    </h4>
    <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
      <p class="text-slate-700 font-medium text-sm" id="detailScheduledDate">--</p>
    </div>
  </div>

  <div>
    <h4 class="text-sm font-bold text-cyan-600 mb-2 flex items-center gap-2">
      <svg class="w-4 h-4 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="9" stroke-width="2"/>
        <path d="M12 7v5l3 3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Scheduled Time
    </h4>
    <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
      <p class="text-slate-700 font-medium text-sm" id="detailScheduledTime">--</p>
    </div>
  </div>
</div>

<!-- Recipient Info -->
<div>
  <h4 class="text-sm font-bold text-cyan-600 mb-2 flex items-center gap-2">
    <svg class="w-4 h-4 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <circle cx="12" cy="8" r="4" stroke-width="2"/>
      <path d="M4 20a8 8 0 0 1 16 0" stroke-width="2" stroke-linecap="round"/>
    </svg>
    Recipient
  </h4>
  <div class="bg-slate-50 rounded-lg p-3 border border-slate-200">
    <p class="text-slate-700 font-medium text-sm" id="detailRecipient">--</p>
  </div>
</div>

            <!-- Additional Info -->
            <div class="bg-cyan-50 rounded-lg p-4 border border-cyan-200">
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <p class="text-xs text-slate-500 font-semibold uppercase">Post ID</p>
                  <p class="text-sm font-bold text-slate-700 mt-1" id="detailPostId">--</p>
                </div>
                <div>
                  <p class="text-xs text-slate-500 font-semibold uppercase">Status</p>
                  <p class="text-sm font-bold text-slate-700 mt-1" id="detailStatus">--</p>
                </div>
              </div>
            </div>
        </div>

        <!-- Modal Footer -->
        <div class="p-4 border-t border-slate-200 bg-slate-50 flex gap-3">
            <button onclick="closePostDetailsModal()" class="flex-1 px-4 py-2 border border-slate-300 rounded-lg font-semibold text-slate-600 hover:bg-slate-100 transition-colors text-sm">Close</button>
            <button onclick="deletePostFromModal()" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition-colors text-sm">Delete Post</button>
        </div>
    </div>
</div>

<div id="postModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden z-[100] flex items-center justify-center p-4">
    <div class="bg-white rounded-3xl w-full max-w-lg overflow-hidden animate-in fade-in zoom-in duration-200 border border-slate-200 max-h-[90vh] flex flex-col">
        <div class="p-4 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-cyan-50/30">
            <div class="flex justify-between items-center">
              <div>
                <h3 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600">Schedule New Post</h3>
                <p class="text-xs text-slate-500 mt-0.5">Plan your social media content</p>
              </div>
              <button onclick="closeModal()" class="w-8 h-8 rounded-lg hover:bg-slate-200 transition flex items-center justify-center text-slate-400 hover:text-slate-600 flex-shrink-0">
                <span class="text-xl font-bold">&times;</span>
              </button>
            </div>
        </div>
        <form id="scheduleForm" class="p-4 space-y-3 overflow-y-auto flex-1">
            <div>
                <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600 mb-1">üì± Platform</label>
                <select id="platform" class="w-full border border-slate-300 rounded-lg p-2 bg-white focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100 transition font-medium text-slate-700 text-sm">
                    <option value="FACEBOOK">Facebook</option>
                    <option value="WHATSAPP">WhatsApp</option>
                    <option value="LINKEDIN">LinkedIn</option>
                    <option value="TWITTER">Twitter</option>
                    <option value="YOUTUBE">YouTube</option>
                    <option value="PINTEREST">Pinterest</option>
                </select>
            </div>
            <div>
                <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600 mb-1">üìû Recipient Number</label>
                <input type="text" id="recipient" placeholder="e.g. 919876543210" class="w-full border border-slate-300 rounded-lg p-2 bg-white focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100 transition font-medium text-slate-700 placeholder-slate-400 text-sm">
            </div>
            <div>
                <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600 mb-1">
  üí¨ Message Content
</label>

<textarea id="content" rows="5"
  class="w-full border border-slate-300 rounded-lg
         p-3 bg-white
         focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100
         transition font-medium text-slate-700
         placeholder-slate-400 resize-none text-sm"
  placeholder="Type your message here..." required>
</textarea>

            </div>
            <div>
  <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600 mb-1 flex items-center gap-2">
    <svg class="w-4 h-4 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="14" rx="2" stroke-width="2"/>
      <circle cx="9" cy="11" r="2" stroke-width="2"/>
      <path d="M21 15l-5-5-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Media (Optional)
  </label>

  <input type="file" id="mediaFile" accept="image/*,video/*"
    class="w-full border border-slate-300 rounded-lg p-2 bg-white focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100 transition font-medium text-slate-700 cursor-pointer file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-xs file:font-semibold file:bg-cyan-100 file:text-cyan-700 hover:file:bg-cyan-200 text-sm">

  <p class="text-xs text-slate-500 mt-1">Images or Videos</p>
</div>

<div>
  <label class="block text-xs font-semibold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600 mb-1 flex items-center gap-2">
    <svg class="w-4 h-4 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="3" y="5" width="18" height="16" rx="2" stroke-width="2"/>
      <path d="M16 3v4M8 3v4M3 9h18" stroke-width="2" stroke-linecap="round"/>
      <path d="M12 13v3l2 2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Schedule Time
  </label>

  <input type="datetime-local" id="scheduledTime"
    class="w-full border border-slate-300 rounded-lg p-2 bg-white focus:border-cyan-400 focus:ring-2 focus:ring-cyan-100 transition font-medium text-slate-700 text-sm"
    required>
</div>

            <div class="flex gap-2 pt-2">
                <button type="button" onclick="closeModal()" class="flex-1 px-3 py-2 border border-slate-300 rounded-lg font-semibold text-slate-600 hover:bg-slate-50 transition-colors text-sm">Cancel</button>
                <button type="submit" class="flex-1 px-3 py-2 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all active:scale-95 text-sm">Schedule Now</button>
            </div>
        </form>
    </div>
</div>

<script src="component/sidebar.js"></script>
<script src="main.js"></script>
<script src="calender.js"></script>


<script>

  // Reload posts every 60 seconds to reflect backend changes (like auto-deletion)
setInterval(() => {
    console.log("üîÑ Auto-refreshing post list...");
    loadPosts(); 
}, 600000); // 600000 ms = 10 minute
function getComputedStatus(post) {
  const now = new Date();
  const scheduledDate = new Date(post.scheduledTime);

  if (post.status === "FAILED") return "FAILED";
  if (post.status === "SENT") return "SENT";

  if (scheduledDate <= now) return "COMPLETED";

  return "PENDING";
}


  // Sidebar profile dropdown
  const sidebarProfileBtn = document.getElementById("sidebarProfileBtn");
  const sidebarProfileMenu = document.getElementById("sidebarProfileMenu");

  sidebarProfileBtn.addEventListener("click", e => {
    e.stopPropagation();
    sidebarProfileMenu.classList.toggle("hidden");
  });

  document.addEventListener("click", () => {
    sidebarProfileMenu.classList.add("hidden");
  });

  function logout() {
    localStorage.clear();
    window.location.href = "home.html";
  }

  window.onload = () => {
    const token = localStorage.getItem("authToken");
    if (!token) window.location.href = "home.html";

    const userEmail = localStorage.getItem("userEmail") || "";
    const userName = localStorage.getItem("userName") || "User";

    // Update desktop sidebar
    document.getElementById("sidebarUserEmail").textContent = userEmail;
    document.getElementById("sidebarUserName").textContent = userName;

    // Update mobile sidebar
    document.getElementById("mobileSidebarUserEmail").textContent = userEmail;
    document.getElementById("mobileSidebarUserName").textContent = userName;
  };
  
// Modal control functions
function openModal() {
    document.getElementById('postModal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('postModal').classList.add('hidden');
    document.getElementById('scheduleForm').reset();
}

// Attach openModal to your "New Post" button
document.querySelectorAll('button').forEach(btn => {
    if(btn.innerText.includes('New Post') || btn.innerText.includes('Schedule Post')) {
        btn.onclick = openModal;
    }
});
// Form submission handler
document.getElementById('scheduleForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const mediaFile = document.getElementById('mediaFile').files[0];
    
    // ===== BACKEND MEDIA UPLOAD CONNECTION POINT =====
    // TODO: Implement media upload to backend
    // 1. Create FormData object with file
    // 2. Send POST request to: http://localhost:8082/api/media/upload
    // 3. Get media ID/URL from response
    // 4. Include mediaId/mediaUrl in postData below
    
    let mediaId = null;
    if (mediaFile) {
        try {
            const formData = new FormData();
            formData.append('file', mediaFile);
            
            // ===== UPLOAD MEDIA TO BACKEND =====
            const mediaResponse = await fetch(API_ENDPOINTS.MEDIA.UPLOAD, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('authToken')
                    // Note: Do NOT set Content-Type, browser will set it with correct boundary
                },
                body: formData
            });
            
            if (mediaResponse.ok) {
                const mediaData = await mediaResponse.json();
                mediaId = mediaData.mediaId || mediaData.id || mediaData.url; // Get media ID
                // Also store mediaUrl if backend returns it
                window.uploadedMediaUrl = mediaData.url || mediaData.mediaUrl || mediaData.path || null;
                console.log("Media uploaded successfully:", mediaId);
                console.log("Media URL:", window.uploadedMediaUrl);
            } else {
                console.warn("Media upload failed, proceeding without media");
            }
        } catch (error) {
            console.error("Error uploading media:", error);
            console.warn("Proceeding with post without media");
        }
    }
    
    const postData = {
        platform: document.getElementById('platform').value,
        recipient: document.getElementById('recipient').value,
        content: document.getElementById('content').value,
        scheduledTime: document.getElementById('scheduledTime').value,
        status: "PENDING",
        mediaId: mediaId, // Include uploaded media ID if available
        mediaUrl: window.uploadedMediaUrl || null // Include media URL if available
    };

    try {
        const response = await fetch(API_ENDPOINTS.POSTS.SCHEDULE, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + localStorage.getItem('authToken')
            },
            body: JSON.stringify(postData)
        });

        if (response.ok) {
            alert("‚úÖ Post scheduled successfully!");
            closeModal();
            // Clear the temporary media URL
            window.uploadedMediaUrl = null;
            loadPosts(); // UI refresh karne ke liye
        } else {
            const errorData = await response.json();
            alert("‚ùå Error: " + (errorData.message || "Failed to schedule post"));
        }
    } catch (error) {
        console.error("Error sending data:", error);
        alert("Server se connection fail ho gaya.");
    }
});

// Store posts data globally
let allPosts = [];
let currentPostView = 'upcoming';

// Switch between Upcoming and Past posts
function switchPostTab(tabName) {
    // Prevent toggle bug: don't do anything if same tab is clicked
    if (currentPostView === tabName) {
        return;
    }
    
    currentPostView = tabName;
    
    const upcomingBtn = document.getElementById('upcomingTab');
    const pastBtn = document.getElementById('pastTab');
    const upcomingContent = document.getElementById('upcomingViewContent');
    const pastContent = document.getElementById('pastViewContent');
    const tabUnderline = document.getElementById('tabUnderline');
    
    if (tabName === 'upcoming') {
        // Active: Upcoming
        upcomingBtn.classList.remove('text-slate-400');
        upcomingBtn.classList.add('text-slate-900');
        
        // Inactive: Past
        pastBtn.classList.remove('text-slate-900');
        pastBtn.classList.add('text-slate-400');
        
        // Position underline under Scheduled Posts
        const tabWidth = upcomingBtn.offsetWidth;
        tabUnderline.style.left = upcomingBtn.offsetLeft + 'px';
        tabUnderline.style.width = tabWidth + 'px';
        
        // Show upcoming, hide past
        upcomingContent.classList.remove('hidden');
        pastContent.classList.add('hidden');
        renderUpcomingPosts();
    } else {
        // Active: Past
        pastBtn.classList.remove('text-slate-400');
        pastBtn.classList.add('text-slate-900');
        
        // Inactive: Upcoming
        upcomingBtn.classList.remove('text-slate-900');
        upcomingBtn.classList.add('text-slate-400');
        
        // Position underline under Completed Posts
        const tabWidth = pastBtn.offsetWidth;
        tabUnderline.style.left = pastBtn.offsetLeft + 'px';
        tabUnderline.style.width = tabWidth + 'px';
        
        // Show past, hide upcoming
        pastContent.classList.remove('hidden');
        upcomingContent.classList.add('hidden');
        renderPastPosts();
    }
}

// Initialize tabs on page load
window.addEventListener('DOMContentLoaded', function() {
    const upcomingBtn = document.getElementById('upcomingTab');
    const tabUnderline = document.getElementById('tabUnderline');
    
    // Set initial underline position
    if (upcomingBtn) {
        const tabWidth = upcomingBtn.offsetWidth;
        tabUnderline.style.left = upcomingBtn.offsetLeft + 'px';
        tabUnderline.style.width = tabWidth + 'px';
    }
    
    // Handle window resize to adjust underline
    window.addEventListener('resize', function() {
        const activeBtn = currentPostView === 'upcoming' 
            ? document.getElementById('upcomingTab') 
            : document.getElementById('pastTab');
        
        if (activeBtn && tabUnderline) {
            const tabWidth = activeBtn.offsetWidth;
            tabUnderline.style.left = activeBtn.offsetLeft + 'px';
            tabUnderline.style.width = tabWidth + 'px';
        }
    });
});

async function loadPosts() {
    const contentArea = document.getElementById('contentArea');
    try {
        const response = await fetch(API_ENDPOINTS.POSTS.ALL, {
            headers: { 'Authorization': 'Bearer ' + localStorage.getItem('authToken') }
        });
        allPosts = await response.json();

        if (allPosts.length === 0) {
            document.getElementById('upcomingViewContent').innerHTML = `
              <div class="flex flex-col items-center justify-center py-20 px-6 rounded-2xl bg-gradient-to-br from-blue-50/50 to-cyan-50/30 border border-cyan-200/30">
  
  <div class="w-20 h-20 rounded-full bg-gradient-to-br from-cyan-100 to-blue-100 flex items-center justify-center mb-6 shadow-lg border border-cyan-200/50">
    <svg class="w-10 h-10 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <rect x="6" y="4" width="12" height="16" rx="2" stroke-width="2"/>
      <path d="M9 4h6v2a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1V4Z" stroke-width="2"/>
      <path d="M9 12h6M9 16h4" stroke-width="2" stroke-linecap="round"/>
    </svg>
  </div>

  <h3 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600 mb-3">
    No Posts Yet
  </h3>

  <p class="text-slate-600 text-center max-w-sm font-medium mb-6">
    Start by creating your first post to see it displayed here
  </p>

  <button onclick="openModal()" class="px-6 py-3 bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-xl font-bold text-sm hover:shadow-lg transition-all active:scale-95">
    Create First Post
  </button>

</div>

            `;
            if(contentArea) contentArea.classList.remove('hidden');
            return;
        }
        if(contentArea) contentArea.classList.add('hidden');
        
        // Render upcoming posts by default
        renderUpcomingPosts();

    } catch (error) {
        console.error("Error loading posts:", error);
        document.getElementById('upcomingViewContent').innerHTML = `<p class="text-red-500 italic text-center">Error loading posts.</p>`;
    }
}

// Render upcoming posts
function renderUpcomingPosts() {
    const now = new Date();
    const upcomingPosts = allPosts.filter(post => new Date(post.scheduledTime) > now);
    
    const listView = document.getElementById('upcomingViewContent');
    
    if (upcomingPosts.length === 0) {
        listView.innerHTML = `
          <div class="flex flex-col items-center justify-center py-20 px-6 rounded-2xl bg-gradient-to-br from-blue-50/50 to-cyan-50/30 border border-cyan-200/30">
  
  <div class="w-20 h-20 rounded-full bg-gradient-to-br from-cyan-100 to-blue-100 flex items-center justify-center mb-6 shadow-lg border border-cyan-200/50">
    <svg class="w-10 h-10 text-cyan-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" stroke-width="2"/>
      <path d="M12 7v5l3 3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>

  <h3 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-600 to-blue-600 mb-3">
    No Upcoming Posts
  </h3>

  <p class="text-slate-600 text-center max-w-sm font-medium mb-6">
    All your scheduled posts are in the past. Create new ones!
  </p>

  <button onclick="openModal()" class="px-6 py-3 bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-xl font-bold text-sm hover:shadow-lg transition-all active:scale-95">
    Schedule New Post
  </button>

</div>

        `;
        return;
    }
    
    renderPostCards(upcomingPosts, listView);
}

// Render past posts
function renderPastPosts() {
    const now = new Date();
    const pastPosts = allPosts.filter(post => new Date(post.scheduledTime) <= now);
    
    const pastView = document.getElementById('pastViewContent');
    
    if (pastPosts.length === 0) {
        pastView.innerHTML = `
          <div class="flex flex-col items-center justify-center py-20 px-6 rounded-2xl bg-gradient-to-br from-green-50/50 to-emerald-50/30 border border-green-200/30">
  
  <div class="w-20 h-20 rounded-full bg-gradient-to-br from-green-100 to-emerald-100 flex items-center justify-center mb-6 shadow-lg border border-green-200/50">
    <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path d="M3 3v5h5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <circle cx="12" cy="12" r="8" stroke-width="2"/>
      <path d="M12 8v5l3 2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>

  <h3 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-green-600 to-emerald-600 mb-3">
    No Past Updates Yet
  </h3>

  <p class="text-slate-600 text-center max-w-sm font-medium">
    Your completed scheduled posts will appear here once their scheduled time passes.
  </p>

</div>

        `;
        return;
    }
    
    renderPostCards(pastPosts, pastView);
}

// Common function to render post cards
function renderPostCards(posts, container) {
    let cardsHtml = `
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
`;
    
    posts.forEach(post => {
        const now = new Date();
        const scheduledDate = new Date(post.scheduledTime);
        const isPast = scheduledDate <= now;
        
        

        const platformIcon =
            post.platform === "FACEBOOK" ? "assets/facebook.png" :
            post.platform === "WHATSAPP" ? "assets/whatsapp.png" :
            post.platform === "LINKEDIN" ? "assets/linkedin.png" :
            post.platform === "TWITTER" ? "assets/twitter.png" :
            post.platform === "YOUTUBE" ? "assets/youtube.png" :
            post.platform === "PINTEREST" ? "assets/pintrest.png" : "assets/graphuralogo.png";

        const accentColor =
            post.platform === "FACEBOOK" ? "blue" :
            post.platform === "WHATSAPP" ? "green" :
            post.platform === "LINKEDIN" ? "blue" :
            post.platform === "TWITTER" ? "slate" :
            post.platform === "YOUTUBE" ? "red" :
            post.platform === "PINTEREST" ? "rose" : "cyan";

        const computedStatus = getComputedStatus(post);

         const statusStyle =
         computedStatus === "COMPLETED"
        ? "status-completed"
        : computedStatus === "FAILED"
        ? "bg-red-100 text-red-700"
        : computedStatus === "SENT"
        ? "bg-cyan-100 text-cyan-700"
        : "bg-blue-100 text-blue-700";


        cardsHtml += `
    <div class="group relative rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer border border-slate-100 flex flex-col h-full bg-gradient-to-br from-white to-blue-50/40 hover:border-cyan-300/40">
      
      <div class="p-3 relative z-10 flex flex-col flex-1">
        <!-- Header with Icon and Status -->
        <div class="flex items-start justify-between mb-3 gap-2">
          <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-${accentColor}-100 to-${accentColor === 'cyan' ? 'blue' : accentColor === 'green' ? 'emerald' : accentColor === 'blue' ? 'indigo' : accentColor === 'slate' ? 'blue' : accentColor === 'red' ? 'orange' : 'pink'}-100 flex items-center justify-center group-hover:scale-105 transition-transform duration-300 flex-shrink-0 border border-${accentColor}-200/50 shadow-sm overflow-hidden p-1">
            <img src="${platformIcon}" alt="${post.platform}" class="w-full h-full object-contain">
          </div>
          <div class="flex flex-col items-end gap-1 flex-shrink-0">
            <span class="px-2.5 py-0.5 sm:px-2 sm:py-0.5 rounded-full text-xs sm:text-xs font-bold whitespace-nowrap overflow-hidden text-ellipsis max-w-xs ${statusStyle}">
           ${computedStatus}
          </span>

            ${post.mediaUrl ? '<span class="px-2.5 py-0.5 sm:px-2 sm:py-0.5 rounded-full text-xs sm:text-xs font-bold bg-gradient-to-r from-purple-100 to-pink-100 text-purple-600 whitespace-nowrap shadow-sm border border-purple-200/50">üñºÔ∏è</span>' : ''}
          </div>
        </div>

        <!-- Platform Title -->
        <h3 class="text-sm font-bold bg-clip-text text-transparent bg-gradient-to-r from-slate-800 to-slate-600 mb-1.5">${post.platform}</h3>

        <!-- Media Preview -->
        ${post.mediaUrl ? `
          <div class="mb-3 rounded-lg overflow-hidden h-24 bg-gradient-to-br from-slate-100 to-slate-200 flex-shrink-0 border border-slate-200/60 shadow-sm">
            ${post.mediaUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i) ? 
              `<img src="${post.mediaUrl}" alt="media" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">` :
              `<video src="${post.mediaUrl}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"></video>`
            }
          </div>
        ` : ''}

        <!-- Content Preview -->
        <p class="text-slate-700 text-xs mb-2 leading-relaxed line-clamp-2 flex-grow font-medium">
          ${post.content}
        </p>

        <!-- Details Section -->
        <div class="space-y-2 pt-3 border-t border-slate-200/50">

  <!-- Scheduled Date & Time -->
  <div class="flex items-center gap-2 text-xs">
    <svg class="w-4 h-4 text-cyan-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="9" stroke-width="2"/>
      <path d="M12 7v5l3 3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <div>
      <p class="text-slate-700 font-semibold">
        ${scheduledDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
      </p>
      <p class="text-slate-500 text-xs">
        ${scheduledDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })}
      </p>
    </div>
  </div>

  <!-- Recipient -->
  <div class="flex items-center gap-2 text-xs">
    <svg class="w-4 h-4 text-cyan-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <circle cx="12" cy="8" r="4" stroke-width="2"/>
      <path d="M4 20a8 8 0 0 1 16 0" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <div>
      <p class="text-slate-700 font-semibold truncate">
        ${post.recipient}
      </p>
    </div>
  </div>

</div>


        <!-- Action Button -->
        <button onclick="openPostDetailsModal(${JSON.stringify(post).replace(/"/g, '&quot;')})" class="w-full mt-4 py-2 px-3 bg-gradient-to-r from-cyan-400 to-blue-500 text-white rounded-lg font-semibold text-xs hover:shadow-lg hover:from-cyan-500 hover:to-blue-600 transition-all active:scale-95 flex-shrink-0 border border-cyan-300/40">
          View Details
        </button>
      </div>
    </div>
  `;
    });

    cardsHtml += `</div>`;
    container.innerHTML = cardsHtml;
}

// Page load par posts load karein
window.addEventListener('DOMContentLoaded', loadPosts);

// ===== POST DETAILS MODAL FUNCTIONS =====
let currentPost = null;

function openPostDetailsModal(post) {
    currentPost = post;

    // ===== COMPUTE STATUS BASED ON TIME =====
    const now = new Date();
    const scheduledDate = new Date(post.scheduledTime);

    let computedStatus = post.status;

    // üî• TIME-BASED STATUS OVERRIDE
    if (post.status === "PENDING" && scheduledDate <= now) {
        computedStatus = "COMPLETED";
    }

    // ===== PLATFORM ICONS =====
    const platformIcons = {
        "FACEBOOK": "assets/facebook.png",
        "WHATSAPP": "assets/whatsapp.png",
        "LINKEDIN": "assets/linkedin.png",
        "TWITTER": "assets/twitter.png",
        "YOUTUBE": "assets/youtube.png",
        "PINTEREST": "assets/pintrest.png",
        "DEFAULT": "assets/graphuralogo.png"
    };

    // ===== STATUS STYLES =====
    const statusStyles = {
        "PENDING": "bg-blue-100 text-blue-700",
        "COMPLETED": "bg-green-100 text-green-700 border border-green-200",
        "SENT": "bg-cyan-100 text-cyan-700",
        "FAILED": "bg-red-100 text-red-700"
    };

    // ===== STATUS BADGE (FIXED) =====
    const badge = document.getElementById('detailStatusBadge');
    badge.textContent = computedStatus;
    badge.className = `status-badge px-4 py-2 sm:px-3 sm:py-1.5 rounded-lg font-bold max-w-[200px] sm:max-w-[250px] ${statusStyles[computedStatus] || statusStyles["PENDING"]}`;

    // ===== MODAL HEADER =====
    document.getElementById('detailModalTitle').textContent = post.platform;
    document.getElementById('detailModalPlatform').textContent = `Scheduled on ${post.platform}`;

    // ===== PLATFORM ICON =====
    const iconElement = document.getElementById('detailPlatformIcon');
    iconElement.innerHTML = `
        <img src="${platformIcons[post.platform] || platformIcons.DEFAULT}"
             alt="${post.platform}"
             class="w-full h-full object-contain p-2">
    `;

    // ===== MEDIA HANDLING =====
    const detailMediaContainer = document.getElementById('detailMediaContainer');
    const detailMediaImage = document.getElementById('detailMediaImage');
    const detailMediaVideo = document.getElementById('detailMediaVideo');

    const mediaUrl =
        post.mediaUrl ||
        post.media ||
        post.mediaLink ||
        post.mediaPath ||
        null;

    if (mediaUrl) {
        detailMediaContainer.classList.remove('hidden');

        if (mediaUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
            detailMediaImage.src = mediaUrl;
            detailMediaImage.classList.remove('hidden');
            detailMediaVideo.classList.add('hidden');
        } else if (mediaUrl.match(/\.(mp4|webm|ogg|mov|avi)$/i)) {
            detailMediaVideo.src = mediaUrl;
            detailMediaVideo.classList.remove('hidden');
            detailMediaImage.classList.add('hidden');
        }
    } else {
        detailMediaContainer.classList.add('hidden');
        detailMediaImage.classList.add('hidden');
        detailMediaVideo.classList.add('hidden');
    }

    // ===== CONTENT =====
    document.getElementById('detailContent').textContent = post.content;

    document.getElementById('detailScheduledDate').textContent =
        scheduledDate.toLocaleDateString();

    document.getElementById('detailScheduledTime').textContent =
        scheduledDate.toLocaleTimeString();

    document.getElementById('detailRecipient').textContent =
        post.recipient || 'Not specified';

    document.getElementById('detailPostId').textContent =
        post.id || 'N/A';

    // üî• FIXED STATUS TEXT (IMPORTANT)
    document.getElementById('detailStatus').textContent = computedStatus;

    // ===== SHOW MODAL =====
    const modal = document.getElementById('postDetailsModal');
    modal.classList.remove('hidden');

    // Close modal when clicking outside
    modal.onclick = (e) => {
        if (e.target.id === 'postDetailsModal') {
            closePostDetailsModal();
        }
    };
}


function closePostDetailsModal() {
    document.getElementById('postDetailsModal').classList.add('hidden');
    currentPost = null;
}

// Delete post from card
async function deletePost(postId) {
    if (!confirm('Are you sure you want to delete this scheduled post?')) {
        return;
    }

    try {
        const response = await fetch(API_ENDPOINTS.POSTS.GET_BY_ID(postId), {
            method: 'DELETE',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('authToken'),
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            alert('‚úÖ Post deleted successfully!');
            loadPosts(); // Refresh the list
        } else {
            const errorData = await response.json();
            alert('‚ùå Error: ' + (errorData.message || 'Failed to delete post'));
        }
    } catch (error) {
        console.error('Error deleting post:', error);
        alert('‚ùå Error deleting post. Please try again.');
    }
}

// Delete post from modal
async function deletePostFromModal() {
    if (!currentPost) return;
    
    if (!confirm('Are you sure you want to delete this scheduled post?')) {
        return;
    }

    try {
        const response = await fetch(API_ENDPOINTS.POSTS.UPDATE(currentPost.id), {
            method: 'DELETE',
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('authToken'),
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            alert('‚úÖ Post deleted successfully!');
            closePostDetailsModal();
            loadPosts(); // Refresh the list
        } else {
            const errorData = await response.json();
            alert('‚ùå Error: ' + (errorData.message || 'Failed to delete post'));
        }
    } catch (error) {
        console.error('Error deleting post:', error);
        alert('‚ùå Error deleting post. Please try again.');
    }
}

// Close modal on Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closePostDetailsModal();
    }
});

// Mobile Sidebar Functions
function openMobileSidebar() {
  const mobileSidebar = document.getElementById('mobileSidebar');
  const overlay = document.getElementById('mobileSidebarOverlay');
  mobileSidebar.classList.add('open');
  overlay.classList.add('open');
}

function closeMobileSidebar() {
  const mobileSidebar = document.getElementById('mobileSidebar');
  const overlay = document.getElementById('mobileSidebarOverlay');
  mobileSidebar.classList.remove('open');
  overlay.classList.remove('open');
}

// Mobile Sidebar Profile Menu
document.addEventListener('DOMContentLoaded', function() {
  const mobileSidebarProfileBtn = document.getElementById('mobileSidebarProfileBtn');
  const mobileSidebarProfileMenu = document.getElementById('mobileSidebarProfileMenu');

  if (mobileSidebarProfileBtn && mobileSidebarProfileMenu) {
    mobileSidebarProfileBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      mobileSidebarProfileMenu.classList.toggle('hidden');
    });

    document.addEventListener('click', (e) => {
      if (!mobileSidebarProfileBtn.contains(e.target) && !mobileSidebarProfileMenu.contains(e.target)) {
        mobileSidebarProfileMenu.classList.add('hidden');
      }
    });
  }
});

</script>

</body>
</html>
