<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/webp" href="assets/Graphura-favicon.webp">
  <title>Graphura | Reset Password</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="config.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    html { scroll-behavior: smooth; }

    .gradient-primary {
      background: linear-gradient(135deg, rgba(248, 250, 252, 1) 0%, rgba(255, 255, 255, 1) 50%, rgba(241, 245, 249, 1) 100%);
    }

    .glass {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.7);
    }

    .gradient-text {
      background: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .form-card {
      background: rgba(250, 251, 252, 0.95);
      border: 1px solid rgba(226, 232, 240, 0.4);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      transition: all 0.3s ease;
    }

    .form-card:hover {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
    }

    .form-input {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      background: rgba(255, 255, 255, 0.98);
    }

    .form-input:hover {
      border-color: rgba(226, 232, 240, 0.8);
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.06);
    }

    .form-input:focus {
      background: #ffffff;
      border-color: rgba(249, 115, 22, 0.6);
      box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1), 0 4px 20px rgba(249, 115, 22, 0.1);
    }

    .form-group {
      position: relative;
    }

    .form-label {
      display: block;
      margin-bottom: 0.625rem;
      color: #475569;
      font-size: 0.8125rem;
      font-weight: 600;
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }

    .input-wrapper {
      position: relative;
    }

    .form-input-with-icon {
      padding-left: 1rem;
    }

    .btn-gradient {
      background: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
      transition: all 0.3s ease;
      color: white;
      font-weight: 600;
    }

    .btn-gradient:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(249, 115, 22, 0.3);
    }

    .btn-gradient:active {
      transform: translateY(0);
    }

    .btn-loading .btn-spinner {
      display: inline-block;
    }

    .btn-spinner {
      display: none;
      width: 16px;
      height: 16px;
      border-radius: 9999px;
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-top-color: #ffffff;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .step-card {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(226, 232, 240, 0.8);
      border-radius: 16px;
      padding: 14px 16px;
      display: flex;
      gap: 12px;
      align-items: flex-start;
      box-shadow: 0 12px 30px rgba(2, 6, 23, 0.06);
    }

    .step-icon {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-weight: 700;
      color: white;
      background: linear-gradient(135deg, #f97316 0%, #ec4899 100%);
      box-shadow: 0 10px 20px rgba(249, 115, 22, 0.25);
      flex-shrink: 0;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 9999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
    }

    .message-card {
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 0.875rem;
      border: 1px solid transparent;
    }

    .message-success {
      background: linear-gradient(180deg, rgba(236, 253, 245, 0.9), rgba(240, 253, 244, 0.9));
      border-color: rgba(16, 185, 129, 0.2);
      color: #065f46;
    }

    .message-error {
      background: linear-gradient(180deg, rgba(255, 241, 240, 0.9), rgba(255, 247, 245, 0.9));
      border-color: rgba(248, 113, 113, 0.35);
      color: #9f1239;
    }

    .error-message {
      animation: slideInError 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideInError {
      from {
        opacity: 0;
        transform: translateY(-4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .password-toggle {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.72rem;
      font-weight: 700;
      color: #64748b;
      background: rgba(248, 250, 252, 0.95);
      border: 1px solid rgba(226, 232, 240, 0.9);
      padding: 4px 10px;
      border-radius: 9999px;
      transition: all 0.2s ease;
    }

    .password-toggle:hover {
      color: #f97316;
      border-color: rgba(249, 115, 22, 0.45);
      box-shadow: 0 6px 14px rgba(2, 6, 23, 0.06);
    }
  </style>
</head>
<body class="gradient-primary text-slate-800 min-h-screen flex flex-col m-0 p-0">
  <nav class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-[95%] max-w-6xl">
    <div class="bg-white/80 backdrop-blur-xl border border-white/60 rounded-full px-6 py-4 shadow-lg hover:shadow-xl transition-shadow">
      <div class="flex items-center justify-between gap-4">
        <div class="flex items-center gap-3 flex-shrink-0">
          <img src="assets/graphuralogo.png" class="h-10 w-auto" alt="Graphura Logo">
        </div>
        <div class="flex items-center gap-3">
          <a href="login-signup.html"
             class="px-5 py-2 rounded-full text-xs md:text-sm font-semibold text-white
                    bg-gradient-to-br from-orange-400 to-pink-500 hover:shadow-lg transition">
            Back to Login
          </a>
        </div>
      </div>
    </div>
  </nav>

  <main class="flex-1 flex items-center justify-center px-4 py-6 md:py-8 mt-20">
    <div class="w-full max-w-6xl">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
        <div class="hidden lg:block space-y-6">
          <div class="inline-flex items-center gap-3 px-4 py-2 glass rounded-full text-xs font-semibold text-slate-600 uppercase tracking-wide">
            <span class="badge-dot"></span>
            Secure reset
          </div>
          <div>
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 leading-tight">
              Set a fresh password
              <span class="gradient-text">in minutes.</span>
            </h1>
            <p class="text-base md:text-lg text-slate-600 max-w-lg leading-relaxed mt-4">
              Use the reset link from your email, then choose a strong new password to regain access.
            </p>
            <p class="text-xs md:text-sm text-slate-500 mt-3">
              Reset tokens expire in 15 minutes for your security.
            </p>
          </div>

          <div class="grid gap-4">
            <div class="step-card">
              <div class="step-icon">1</div>
              <div>
                <h3 class="text-sm font-semibold text-slate-900">Open your reset email</h3>
                <p class="text-sm text-slate-600 mt-1">Your token is pre-filled when you use the link.</p>
              </div>
            </div>
            <div class="step-card">
              <div class="step-icon">2</div>
              <div>
                <h3 class="text-sm font-semibold text-slate-900">Create a strong password</h3>
                <p class="text-sm text-slate-600 mt-1">Use at least 8 characters with a mix of letters and numbers.</p>
              </div>
            </div>
            <div class="step-card">
              <div class="step-icon">3</div>
              <div>
                <h3 class="text-sm font-semibold text-slate-900">Sign in again</h3>
                <p class="text-sm text-slate-600 mt-1">Return to login and continue managing your socials.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="form-card rounded-3xl p-6 md:p-10">
          <div class="mb-8 text-center">
            <div class="inline-block mb-4 p-3 bg-gradient-to-br from-orange-100/80 to-pink-100/80 rounded-2xl">
              <i class="fas fa-key text-orange-600 text-2xl"></i>
            </div>
            <h2 class="text-3xl md:text-4xl font-extrabold text-slate-900 mb-2">Reset Password</h2>
            <p class="text-sm text-slate-600 tracking-wide">set a new password</p>
          </div>

          <form id="resetForm" class="space-y-4">
            <div class="form-group">
              <label class="form-label"><i class="fas fa-lock text-orange-500 mr-2"></i>New Password</label>
              <div class="input-wrapper">
                <input id="rpPassword" type="password" placeholder="Minimum 8 characters" autocomplete="new-password"
                  class="form-input w-full px-4 py-3 rounded-xl border border-slate-200 bg-white text-sm outline-none pr-20">
                <button type="button" class="password-toggle" data-target="rpPassword">Show</button>
              </div>
              <p id="rpPasswordError" class="hidden error-message text-xs text-red-500 mt-1.5 flex items-center">
                <i class="fas fa-exclamation-circle mr-1.5"></i>
              </p>
            </div>

            <div class="form-group">
              <label class="form-label"><i class="fas fa-shield-alt text-orange-500 mr-2"></i>Confirm Password</label>
              <div class="input-wrapper">
                <input id="rpConfirm" type="password" placeholder="Re-enter password" autocomplete="new-password"
                  class="form-input w-full px-4 py-3 rounded-xl border border-slate-200 bg-white text-sm outline-none pr-20">
                <button type="button" class="password-toggle" data-target="rpConfirm">Show</button>
              </div>
              <p id="rpConfirmError" class="hidden error-message text-xs text-red-500 mt-1.5 flex items-center">
                <i class="fas fa-exclamation-circle mr-1.5"></i>
              </p>
            </div>

            <div class="text-xs text-slate-500">
              Tip: Use at least 8 characters, and avoid reusing an old password.
            </div>

            <div id="rpMessage" class="hidden message-card" role="status" aria-live="polite"></div>

            <button id="rpSubmit" type="submit" class="btn-gradient w-full py-3 rounded-xl font-bold text-white text-sm shadow-lg mt-2 relative group flex items-center justify-center gap-3">
              <span class="btn-label">Update Password</span>
              <span class="btn-spinner" aria-hidden="true"></span>
            </button>
          </form>

          <div class="text-center pt-6 border-t border-slate-200/60 mt-6">
            <p class="text-sm text-slate-700">
              Remembered your password?
              <a href="login-signup.html" class="font-bold text-transparent bg-gradient-to-r from-orange-500 to-pink-500 bg-clip-text hover:opacity-80 transition">Back to login</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
    <div class="absolute top-0 right-0 w-96 h-96 bg-gradient-to-bl from-orange-200/25 to-pink-200/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 left-0 w-96 h-96 bg-gradient-to-tr from-orange-200/10 to-pink-200/5 rounded-full blur-3xl"></div>
  </div>

  <script>
    let isSubmitting = false;

    function isValidPassword(password) {
      return password && password.length >= 8;
    }

    async function parseResponse(res) {
      const text = await res.text();
      let data = null;
      if (text) {
        try {
          data = JSON.parse(text);
        } catch (err) {
          data = null;
        }
      }
      let message = '';
      if (typeof data === 'string') {
        message = data;
      } else if (data && typeof data === 'object') {
        message = data.message || data.error || data.msg || data.details || '';
      }
      if (!message) message = text || res.statusText || `Request failed (${res.status})`;
      return { ok: res.ok, status: res.status, data: data || {}, message };
    }

    function setMessage(type, text) {
      const el = document.getElementById('rpMessage');
      if (!el) return;
      el.textContent = text;
      el.classList.remove('hidden', 'message-success', 'message-error');
      el.classList.add(type === 'error' ? 'message-error' : 'message-success');
    }

    function clearMessage() {
      const el = document.getElementById('rpMessage');
      if (!el) return;
      el.classList.add('hidden');
      el.textContent = '';
    }

    function showInlineError(id, message) {
      const el = document.getElementById(id);
      if (!el) return;
      el.textContent = message;
      el.classList.remove('hidden');
    }

    function clearInlineErrors(ids) {
      ids.forEach((id) => {
        const el = document.getElementById(id);
        if (el) el.classList.add('hidden');
      });
    }

    function setLoading(loading) {
      const btn = document.getElementById('rpSubmit');
      if (!btn) return;
      if (loading) {
        btn.classList.add('btn-loading');
        btn.setAttribute('disabled', 'disabled');
      } else {
        btn.classList.remove('btn-loading');
        btn.removeAttribute('disabled');
      }
    }

    function setupPasswordToggles() {
      const toggles = document.querySelectorAll('.password-toggle');
      toggles.forEach((toggle) => {
        toggle.addEventListener('click', () => {
          const targetId = toggle.getAttribute('data-target');
          const input = document.getElementById(targetId);
          if (!input) return;
          const show = input.type === 'password';
          input.type = show ? 'text' : 'password';
          toggle.textContent = show ? 'Hide' : 'Show';
        });
      });
    }

    let tokenFromUrl = '';

    function populateTokenFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      if (token) {
        tokenFromUrl = token;
      }
    }

    document.getElementById('resetForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (isSubmitting) return;
      isSubmitting = true;

      clearInlineErrors(['rpTokenError', 'rpPasswordError', 'rpConfirmError']);
      clearMessage();

      const token = tokenFromUrl;
      const password = document.getElementById('rpPassword').value;
      const confirm = document.getElementById('rpConfirm').value;

      if (!token) {
        showInlineError('rpTokenError', 'Reset link is missing or expired. Please request a new reset email.');
        isSubmitting = false;
        return;
      }
      if (!isValidPassword(password)) {
        showInlineError('rpPasswordError', 'Password must be at least 8 characters');
        isSubmitting = false;
        return;
      }
      if (password !== confirm) {
        showInlineError('rpConfirmError', 'Passwords do not match');
        isSubmitting = false;
        return;
      }

      try {
        setLoading(true);
        const res = await fetch(API_ENDPOINTS.AUTH.RESET_PASSWORD, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token, newPassword: password })
        });
        const result = await parseResponse(res);
        if (result.ok) {
          setMessage('success', 'Password reset successful. Redirecting to login...');
          document.getElementById('rpPassword').value = '';
          document.getElementById('rpConfirm').value = '';
          setTimeout(() => {
            window.location.href = 'login-signup.html';
          }, 1600);
        } else {
          setMessage('error', result.message || 'Unable to reset password. Please try again.');
        }
      } catch (err) {
        setMessage('error', 'Backend not reachable');
      }

      setLoading(false);
      isSubmitting = false;
    });

    setupPasswordToggles();
    populateTokenFromUrl();
  </script>
</body>
</html>
